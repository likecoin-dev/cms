if("undefined"==typeof jQuery)throw new Error("Froala requires jQuery");!function(t){"use strict";var e=function(i,n){this.options=t.extend({},e.DEFAULTS,t(i).data(),"object"==typeof n&&n),this.browser=e.browser(),this.disabledList=[],this._id=++e.count,this.init(i)};e.count=0,e.VALID_NODES=["P","PRE","BLOCKQUOTE","H1","H2","H3","H4","H5","H6","DIV","LI"],e.COLORS=["#000000","#444444","#666666","#999999","#CCCCCC","#EEEEEE","#F3F3F3","#FFFFFF","#FF0000","#FF9900","#FFFF00","#00FF00","#00FFFF","#0000FF","#9900FF","#FF00FF","#F4CCCC","#FCE5CD","#FFF2CC","#D9EAD3","#D0E0E3","#CFE2F3","#D9D2E9","#EAD1DC","#EA9999","#F9CB9C","#FFE599","#B6D7A8","#A2C4C9","#9FC5E8","#B4A7D6","#D5A6BD","#E06666","#F6B26B","#FFD966","#93C47D","#76A5AF","#6FA8DC","#8E7CC3","#C27BA0","#CC0000","#E69138","#F1C232","#6AA84F","#45818E","#3D85C6","#674EA7","#A64D79","#990000","#B45F06","#BF9000","#38771D","#134F5C","#0B5394","#351C75","#741B47","#660000","#783F04","#7F6000","#274E13","#0C343D","#073763","#201211","#4C1130"],e.image_commands={floatImageLeft:{title:"Float Left",icon:{type:"font",value:"fa fa-align-left"}},floatImageNone:{title:"Float None",icon:{type:"font",value:"fa fa-align-justify"}},floatImageRight:{title:"Float Right",icon:{type:"font",value:"fa fa-align-right"}},linkImage:{title:"Insert Link",icon:{type:"font",value:"fa fa-link"}},replaceImage:{title:"Replace Image",icon:{type:"font",value:"fa fa-exchange"}},removeImage:{title:"Remove Image",icon:{type:"font",value:"fa fa-trash-o"}}},e.commands={bold:{title:"Bold",icon:"fa fa-bold",shortcut:"(Ctrl + B)"},italic:{title:"Italic",icon:"fa fa-italic",shortcut:"(Ctrl + I)"},underline:{cmd:"underline",title:"Underline",icon:"fa fa-underline",shortcut:"(Ctrl + U)"},strikeThrough:{title:"Strikethrough",icon:"fa fa-strikethrough"},fontSize:{title:"Font Size",icon:"fa fa-text-height",seed:[{min:11,max:52}]},color:{icon:"fa fa-tint",title:"Color",seed:[{cmd:"backColor",value:e.COLORS,title:"Background Color"},{cmd:"foreColor",value:e.COLORS,title:"Text Color"}]},formatBlock:{title:"Format Block",icon:"fa fa-paragraph",seed:[{value:"n",title:"Normal"},{value:"p",title:"Paragraph"},{value:"pre",title:"Code"},{value:"blockquote",title:"Quote"},{value:"h1",title:"Heading 1"},{value:"h2",title:"Heading 2"},{value:"h3",title:"Heading 3"},{value:"h4",title:"Heading 4"},{value:"h5",title:"Heading 5"},{value:"h6",title:"Heading 6"}]},blockStyle:{title:"Block Style",icon:"fa fa-magic"},fontFamily:{title:"Font Family",icon:"fa fa-font"},align:{title:"Alignment",icon:"fa fa-align-center",seed:[{cmd:"justifyLeft",title:"Align Left",icon:"fa fa-align-left"},{cmd:"justifyCenter",title:"Align Center",icon:"fa fa-align-center"},{cmd:"justifyRight",title:"Align Right",icon:"fa fa-align-right"},{cmd:"justifyFull",title:"Justify",icon:"fa fa-align-justify"}]},insertOrderedList:{title:"Numbered List",icon:"fa fa-list-ol"},insertUnorderedList:{title:"Bulleted List",icon:"fa fa-list-ul"},outdent:{title:"Indent Less",icon:"fa fa-dedent",activeless:!0,shortcut:"(Ctrl + <)"},indent:{title:"Indent More",icon:"fa fa-indent",activeless:!0,shortcut:"(Ctrl + >)"},selectAll:{title:"Select All",icon:"fa fa-file-text",shortcut:"(Ctrl + A)"},createLink:{title:"Insert Link",icon:"fa fa-link",shortcut:"(Ctrl + K)"},insertImage:{title:"Insert Image",icon:"fa fa-picture-o",activeless:!0,shortcut:"(Ctrl + P)"},undo:{title:"Undo",icon:"fa fa-undo",activeless:!0,shortcut:"(Ctrl+Z)"},redo:{title:"Redo",icon:"fa fa-repeat",activeless:!0,shortcut:"(Shift+Ctrl+Z)"},html:{title:"Show HTML",icon:"fa fa-code"},save:{title:"Save",icon:"fa fa-floppy-o"},insertVideo:{title:"Insert Video",icon:"fa fa-video-camera"},insertHorizontalRule:{title:"Insert Horizontal Line",icon:"fa fa-minus"}},e.LANGS=[],e.DEFAULTS={allowedImageTypes:["jpeg","jpg","png","gif"],alwaysBlank:!1,alwaysVisible:!1,autosave:!1,autosaveInterval:1e4,blockTags:["n","p","blockquote","pre","h1","h2","h3","h4","h5","h6"],defaultBlockStyle:{"f-italic":"Italic","f-typewriter":"Typewriter","f-spaced":"Spaced","f-uppercase":"Uppercase"},blockStyles:{},borderColor:"#252528",buttons:["bold","italic","underline","strikeThrough","fontSize","fontFamily","color","sep","formatBlock","blockStyle","align","insertOrderedList","insertUnorderedList","outdent","indent","sep","createLink","insertImage","insertVideo","undo","redo","insertHorizontalRule","html"],crossDomain:!0,customButtons:{},customDropdowns:{},customText:!1,defaultImageWidth:300,direction:"ltr",editorClass:"",enableScript:!1,fontList:["Arial, Helvetica","Impact, Charcoal","Tahoma, Geneva","Verdana, Geneva","Times New Roman, Times"],height:"auto",icons:{},imageButtons:["floatImageLeft","floatImageNone","floatImageRight","linkImage","replaceImage","removeImage"],imageErrorCallback:!1,imageDeleteURL:null,imageDeleteParams:{},imageMargin:10,imageMove:!0,imageUploadParams:{},imageUploadParam:"file",imageUploadURL:"http://i.froala.com/upload",imagesLoadURL:"http://i.froala.com/images",imagesLoadParams:{},imageUpload:!0,imageUploadToS3:!1,inverseSkin:!1,inlineMode:!0,language:"en_us",maxImageSize:10485760,mediaManager:!0,minHeight:"auto",noFollow:!0,paragraphy:!0,placeholder:"Type something",plainPaste:!1,preloaderSrc:"",saveURL:null,saveParams:{},shortcuts:!0,spellcheck:!1,textNearImage:!0,toolbarFixed:!0,typingTimer:200,width:"auto",zIndex:1e3},e.hexToRGB=function(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,i,n){return e+e+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},e.hexToRGBString=function(t){var e=this.hexToRGB(t);return"rgb("+e.r+", "+e.g+", "+e.b+")"},e.getIEversion=function(){var t,e,i=-1;return"Microsoft Internet Explorer"==navigator.appName?(t=navigator.userAgent,e=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})"),null!==e.exec(t)&&(i=parseFloat(RegExp.$1))):"Netscape"==navigator.appName&&(t=navigator.userAgent,e=new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})"),null!==e.exec(t)&&(i=parseFloat(RegExp.$1))),i},e.browser=function(){var t={};if(e.getIEversion()>0)t.msie=!0;else{var i=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(i)||/(webkit)[ \/]([\w.]+)/.exec(i)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(i)||/(msie) ([\w.]+)/.exec(i)||i.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(i)||[],o={browser:n[1]||"",version:n[2]||"0"};n[1]&&(t[o.browser]=!0),parseInt(o.version,10)<9&&t.msie&&(t.oldMsie=!0),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0)}return t},e.prototype.text=function(){var t="";return window.getSelection?t=window.getSelection():document.getSelection?t=document.getSelection():document.selection&&(t=document.selection.createRange().text),t.toString()},e.prototype.selectionInEditor=function(){var e=this.getSelectionParent(),i=!1;return e==this.$element.get(0)&&(i=!0),i===!1&&t(e).parents().each(t.proxy(function(t,e){e==this.$element.get(0)&&(i=!0)},this)),i},e.prototype.getSelection=function(){var t="";return t=window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection.createRange()},e.prototype.getRange=function(){if(window.getSelection){var t=window.getSelection();if(t.getRangeAt&&t.rangeCount)return t.getRangeAt(0)}return document.createRange()},e.prototype.clearSelection=function(){if(window.getSelection){var t=window.getSelection();t.removeAllRanges()}else document.selection.createRange&&(document.selection.createRange(),document.selection.empty())},e.prototype.getSelectionElement=function(){var e=this.getSelection();if(e.rangeCount){var i=e.getRangeAt(0).startContainer;return 1!=i.nodeType&&(i=i.parentNode),t(i).children().length>0&&t(t(i).children()[0]).text()==this.text()&&(i=t(i).children()[0]),i}return this.$element.get(0)},e.prototype.getSelectionParent=function(){var e,i=null;return window.getSelection?(e=window.getSelection(),e.rangeCount&&(i=e.getRangeAt(0).commonAncestorContainer,1!=i.nodeType&&(i=i.parentNode))):(e=document.selection)&&"Control"!=e.type&&(i=e.createRange().parentElement()),null!=i&&(t.inArray(this.$element.get(0),t(i).parents())>=0||i==this.$element.get(0))?i:null},e.prototype.nodeInRange=function(t,e){var i;if(t.intersectsNode)return t.intersectsNode(e);i=e.ownerDocument.createRange();try{i.selectNode(e)}catch(n){i.selectNodeContents(e)}return-1==t.compareBoundaryPoints(Range.END_TO_START,i)&&1==t.compareBoundaryPoints(Range.START_TO_END,i)},e.prototype.getElementFromNode=function(i){for(1!=i.nodeType&&(i=i.parentNode);null!==i&&e.VALID_NODES.indexOf(i.tagName)<0;)i=i.parentNode;return null!=i&&"LI"==i.tagName&&t(i).find(e.VALID_NODES.join()).length>0?null:t.makeArray(t(i).parents()).indexOf(this.$element.get(0))>=0?i:null},e.prototype.nextNode=function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},e.prototype.getRangeSelectedNodes=function(t){var e=t.startContainer,i=t.endContainer;if(e==i)return[e];for(var n=[];e&&e!=i;)n.push(e=this.nextNode(e));for(e=t.startContainer;e&&e!=t.commonAncestorContainer;)n.unshift(e),e=e.parentNode;return n},e.prototype.getSelectedNodes=function(){if(window.getSelection){var t=window.getSelection();if(!t.isCollapsed)return this.getRangeSelectedNodes(t.getRangeAt(0));if(this.selectionInEditor()){var e=t.getRangeAt(0).startContainer;return 3==e.nodeType?[e.parentNode]:[e]}}return[]},e.prototype.getSelectionElements=function(){var e=this.getSelectedNodes(),i=[];return t.each(e,t.proxy(function(t,e){if(null!==e){var n=this.getElementFromNode(e);i.indexOf(n)<0&&n!=this.$element.get(0)&&null!==n&&i.push(n)}},this)),0===i.length&&i.push(this.$element.get(0)),i},e.prototype.getSelectionLink=function(){var t,e=null;return window.getSelection?(t=window.getSelection(),e=1!==t.anchorNode.nodeType?t.anchorNode.parentNode.parentNode.href:t.anchorNode.parentNode.href):(t=document.selection)&&"Control"!=t.type&&(e=t.createRange().parentElement().href),void 0===e?null:e},e.prototype.saveSelection=function(){var t,e,i,n=this.getSelection();if(n.getRangeAt&&n.rangeCount){for(i=[],t=0,e=n.rangeCount;e>t;t+=1)i.push(n.getRangeAt(t));this.savedRanges=i}else this.savedRanges=null},e.prototype.restoreSelection=function(){var t,e,i=this.getSelection();if(this.savedRanges)for(i.removeAllRanges(),t=0,e=this.savedRanges.length;e>t;t+=1)i.addRange(this.savedRanges[t])},e.prototype.saveSelectionByMarkers=function(){var t=this.getRange();this.placeMarker(t,!0),this.placeMarker(t,!1)},e.prototype.restoreSelectionByMarkers=function(){var t=this.$element.find("#marker-true"),e=this.$element.find("#marker-false");return t.length&&e.length?(this.$element.removeAttr("contenteditable"),this.$element.focus(),this.setSelection(t[0],0,e[0],0),this.removeMarkers(),this.isImage||this.isHTML||this.$element.attr("contenteditable",!0),void this.$element.focus()):!1},e.prototype.setSelection=function(t,e,i,n){try{null===i&&(i=t),null===n&&(n=e);var o=this.getSelection();if(!o)return;var s=this.getRange();s.setStart(t,e),s.setEnd(i,n),o.removeAllRanges(),o.addRange(s)}catch(a){}},e.prototype.placeMarker=function(e,i){try{var n=e.cloneRange();n.collapse(i),n.insertNode(t('<span id="marker-'+i+'">',document)[0]),n.detach()}catch(o){}},e.prototype.removeMarkers=function(){this.$element.find("#marker-true, #marker-false").removeAttr("id")},e.prototype.getBoundingRect=function(){var e;if(this.browser.mozilla){e={},this.saveSelectionByMarkers();var i=this.$element.find("#marker-true"),n=this.$element.find("#marker-false");e.left=i.offset().left-t(window).scrollLeft(),e.top=i.offset().top-t(window).scrollTop(),e.width=Math.abs(n.offset().left-i.offset().left),e.height=n.offset().top-i.offset().top+n.get(0).getBoundingClientRect().height,e.right=1,e.bottom=1,this.restoreSelectionByMarkers()}else e=this.getRange().getBoundingClientRect();return e},e.prototype.repositionEditor=function(e){var i,n,o;(this.options.inlineMode||e)&&(i=this.getBoundingRect(),i.left>0&&i.top>0&&i.right>0&&i.bottom>0?(n=i.left+i.width/2+t(window).scrollLeft(),o=i.top+i.height+t(window).scrollTop(),this.isTouch()&&(n=i.left+i.width/2,o=i.top+i.height),this.showByCoordinates(n,o)):this.options.alwaysVisible?this.hide():(document.execCommand("selectAll"),i=this.getBoundingRect(),n=i.left+t(window).scrollLeft(),o=i.top+i.height+t(window).scrollTop(),this.isTouch()&&(n=i.left,o=i.top+i.height),this.showByCoordinates(n,o-20),this.getRange().collapse(!1)))},e.prototype.destroy=function(){this.sync(),this.$editor.remove(),this.$popup_editor&&this.$popup_editor.remove(),this.$overlay&&this.$overlay.remove(),this.$image_modal&&(this.hideMediaManager(),this.$image_modal.remove()),this.$element.replaceWith(this.getHTML()),this.$box.removeClass("froala-box"),this.$box.find(".html-switch").remove(),this.$box.removeData("fa.editable"),clearTimeout(this.typingTimer),clearTimeout(this.ajaxInterval),this.$element.off("mousedown mouseup click keydown keyup focus keypress touchstart touchend touch drop"),this.$element.off("mousedown mouseup click keydown keyup focus keypress touchstart touchend touch drop","**"),t(window).off("mouseup."+this._id),t(window).off("keydown."+this._id),t(window).off("keyup."+this._id),t(window).off("hide."+this._id),t(document).off("selectionchange."+this._id),void 0!==this.$upload_frame&&this.$upload_frame.remove(),this.$textarea&&(this.$box.remove(),this.$textarea.removeData("fa.editable"),this.$textarea.show())},e.prototype.callback=function(e,i,n){void 0===n&&(n=!0);var o=e+"Callback",s=!0;return this.options[o]&&t.isFunction(this.options[o])&&(s=i?this.options[o].apply(this,i):this.options[o].call(this)),n===!0&&(this.sync(),this.$element.focus()),void 0===s?!0:s},e.prototype.html5Compliant=function(e){e.find("b").each(function(e,i){t(i).replaceWith("<strong>"+t(i).html()+"</strong>")}),e.find("i:not(.fa)").each(function(e,i){t(i).replaceWith("<em>"+t(i).html()+"</em>")})},e.prototype.syncClean=function(e,i){var n="span:empty";i&&(n="span:empty:not(#marker-true):not(#marker-false)");for(var o=!1,s=function(e,i){0===i.attributes.length&&(t(i).remove(),o=!1)};e.find(n).length&&o===!1;)o=!0,e.find(n).each(s);e.find("a").addClass("f-link")},e.prototype.addImageWrapper=function(){this.isImage||this.$element.find("img").each(function(e,i){0===t(i).parents(".f-img-wrap").length&&(t(i).parents("a").length>0?t(t(i).parents("a")[0]).wrap('<span class="f-img-wrap"></span>'):t(i).wrap('<span class="f-img-wrap"></span>'))})},e.prototype.sync=function(){this.restoreSelectionByMarkers(),this.syncClean(this.$element),this.disableImageResize(),this.$element.trigger("placeholderCheck"),this.trackHTML!==this.getHTML()&&(this.callback("contentChanged",[],!1),this.refreshImageList(),this.trackHTML=this.getHTML()),this.$textarea&&this.$textarea.val(this.getHTML())},e.prototype.emptyElement=function(e){if("IMG"==e.tagName||t(e).find("img").length>0)return!1;for(var i=t(e).text(),n=0;n<i.length;n++)if("\n"!==i[n]&&"\r"!==i[n]&&"	"!==i[n])return!1;return!0},e.prototype.init=function(t){this.initElement(t),this.initElementStyle(),this.initUndoRedo(),this.enableTyping(),this.initShortcuts(),this.initEditor(),this.initDrag(),this.initOptions(),this.initEditorSelection(),this.initAjaxSaver(),this.initImageResizer(),this.initImagePopup(),this.initLink(),this.setLanguage(),this.setCustomText(),this.registerPaste(),this.$element.blur()},e.prototype.initLink=function(){var e=this;this.$element.on("click touchend","a",function(i){i.stopPropagation(),i.preventDefault(),e.link=!0,e.clearSelection(),e.removeMarkers(),t(this).before('<span id="marker-true"></span>'),t(this).after('<span id="marker-false"></span>'),e.restoreSelectionByMarkers(),e.exec("createLink"),e.$link_wrapper.find('input[type="text"]').val(t(this).attr("href")),e.$link_wrapper.find('input[type="checkbox"]').prop("checked","_blank"==t(this).attr("target")),WYSIWYGModernizr.mq("(max-device-width: 320px) and (-webkit-min-device-pixel-ratio: 2)")?e.showByCoordinates(t(this).offset().left+t(this).width()/2,t(this).offset().top+t(this).height()):e.repositionEditor(!0),e.$popup_editor.show()})},e.prototype.imageHandle=function(){var e=this,i=t("<span>").addClass("f-img-handle").on({movestart:function(i){e.hide(),e.$element.addClass("f-non-selectable").removeAttr("contenteditable"),e.isResizing=!0,t(this).attr("data-start-x",i.startX),t(this).attr("data-start-y",i.startY)},move:function(i){var n=t(this),o=i.pageX-parseInt(n.attr("data-start-x"),10);n.attr("data-start-x",i.pageX),n.attr("data-start-y",i.pageY);var s=n.prevAll("img");n.hasClass("f-h-ne")||n.hasClass("f-h-se")?s.attr("width",s.width()+o):s.attr("width",s.width()-o),e.callback("imageResize",[],!1)},moveend:function(){e.isResizing=!1,t(this).removeAttr("data-start-x"),t(this).removeAttr("data-start-y"),e.$element.removeClass("f-non-selectable"),e.isImage||e.$element.attr("contenteditable",!0),e.$element.removeAttr("data-resize"),e.callback("imageResizeEnd")}});return i},e.prototype.disableImageResize=function(){if(this.browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){}},e.prototype.initImageResizer=function(){this.disableImageResize();var e=this;this.$element.on("mousedown","img",function(){e.imageHTML=e.getHTML(),!e.options.imageMove||e.browser.msie?e.$element.attr("contenteditable",!1):(t(this).parents(".f-img-wrap").removeAttr("contenteditable"),t(this).parent().hasClass("f-img-editor")&&(e.closeImageMode(),e.hide()))}),document.addEventListener("drop",t.proxy(function(){setTimeout(t.proxy(function(){this.sync(),this.clearSelection()},this),10)},this)),this.$element.find("img").each(function(t,e){e.oncontrolselect=function(){return!1}}),this.$element.on("mouseup","img",function(){e.options.imageMove||e.isImage||e.isHTML||e.$element.attr("contenteditable",!0),t(this).parents(".f-img-wrap").attr("contenteditable","false")}),this.$element.on("click touchend","img",function(i){i.preventDefault(),i.stopPropagation(),e.$element.blur(),e.$image_editor.find("button").removeClass("active");var n=t(this).css("float");e.$image_editor.find('button[data-cmd="floatImage'+n.charAt(0).toUpperCase()+n.slice(1)+'"]').addClass("active"),e.$image_editor.find('.f-image-alt input[type="text"]').val(t(this).attr("alt")||t(this).attr("title")),e.showImageEditor(),t(this).parent().hasClass("f-img-editor")&&"SPAN"==t(this).parent().get(0).tagName||(t(this).wrap('<span class="f-img-editor" style="float: '+t(this).css("float")+"; margin-left:"+t(this).css("margin-left")+" ; margin-right:"+t(this).css("margin-right")+"; margin-bottom: "+t(this).css("margin-bottom")+"; margin-top: "+t(this).css("margin-bottom")+';"></span>'),t(this).css("margin-left","auto"),t(this).css("margin-right","auto"),t(this).css("margin-bottom","auto"),t(this).css("margin-top","auto"),0!==t(this).parents(".f-img-wrap").length||e.isImage||(t(this).parent().wrap('<span class="f-img-wrap"></span>'),t(this).parents(".f-img-wrap").attr("contenteditable",!1)));var o=e.imageHandle();t(this).parent().find(".f-img-handle").remove(),t(this).parent().append(o.clone(!0).addClass("f-h-ne")),t(this).parent().append(o.clone(!0).addClass("f-h-se")),t(this).parent().append(o.clone(!0).addClass("f-h-sw")),t(this).parent().append(o.clone(!0).addClass("f-h-nw")),e.clearSelection(),e.showByCoordinates(t(this).offset().left+t(this).width()/2,t(this).offset().top+t(this).height()),e.imageMode=!0}),this.$element.find("img").each(function(t,e){e.oncontrolselect=function(){return!1}})},e.prototype.initImagePopup=function(){this.$image_editor=t("<div>").addClass("bttn-wrapper f-image-editor");for(var i in this.options.imageButtons){var n=this.options.imageButtons[i];if(void 0!==e.image_commands[n]){var o=e.image_commands[n],s=t("<button>").addClass("fr-bttn").attr("data-cmd",n).attr("title",o.title);void 0!==this.options.icons[n]?this.prepareIcon(s,this.options.icons[n]):this.prepareIcon(s,o.icon),this.$image_editor.append(s)}}var a=t('<div class="f-image-alt">').append('<label><span data-text="true">Title</span>: </label>').append(t('<input type="text">').on("mouseup touchend keydown",function(t){t.stopPropagation()})).append(t('<button class="f-ok" data-text="true">').attr("data-cmd","setImageAlt").attr("title","OK").html("OK"));this.$image_editor.append("<hr/>").append(a);var r=this;this.$image_editor.find("button").click(function(e){e.stopPropagation(),r[t(this).attr("data-cmd")](r.$element.find("span.f-img-editor"))}),this.$popup_editor.append(this.$image_editor)},e.prototype.floatImageLeft=function(t){t.css("margin-left","auto"),t.css("margin-right",this.options.imageMargin),t.css("margin-bottom",this.options.imageMargin),t.css("margin-top",this.options.imageMargin),t.css("float","left"),t.find("img").css("float","left"),this.isImage&&this.$element.css("float","left"),this.saveUndoStep(),this.callback("floatImageLeft"),t.find("img").click()},e.prototype.floatImageNone=function(t){t.css("margin-left","auto"),t.css("margin-right","auto"),t.css("margin-bottom",this.options.imageMargin),t.css("margin-top",this.options.imageMargin),t.css("float","none"),t.find("img").css("float","none"),this.isImage||(t.parent().get(0)==this.$element.get(0)?t.wrap('<div style="text-align: center;"></div>'):t.parents(".f-img-wrap:first").css("text-align","center")),this.isImage&&this.$element.css("float","none"),this.saveUndoStep(),this.callback("floatImageNone"),t.find("img").click()},e.prototype.floatImageRight=function(t){t.css("margin-right","auto"),t.css("margin-left",this.options.imageMargin),t.css("margin-bottom",this.options.imageMargin),t.css("margin-top",this.options.imageMargin),t.css("float","right"),t.find("img").css("float","right"),this.isImage&&this.$element.css("float","right"),this.saveUndoStep(),this.callback("floatImageRight"),t.find("img").click()},e.prototype.linkImage=function(t){this.showInsertLink(),this.imageMode=!0,"A"==t.parent().get(0).tagName?(this.$link_wrapper.find('input[type="text"]').val(t.parent().attr("href")),"_blank"==t.parent().attr("target")?this.$link_wrapper.find('input[type="checkbox"]').prop("checked",!0):this.$link_wrapper.find('input[type="checkbox"]').prop("checked",!1)):(this.$link_wrapper.find('input[type="text"]').val("http://"),this.$link_wrapper.find('input[type="checkbox"]').prop("checked",this.options.alwaysBlank))},e.prototype.replaceImage=function(t){this.showInsertImage(),this.imageMode=!0,this.$image_wrapper.find('input[type="text"]').val(t.find("img").attr("src"))},e.prototype.removeImage=function(i){var n=i.find("img").get(0),o="Are you sure? Image will be deleted.";if(e.LANGS[this.options.language]&&(o=e.LANGS[this.options.language].translation[o]),confirm(o)){if(this.callback("beforeRemoveImage",[t(n).attr("src")],!1)===!0){var s=t(n).attr("src");i.parent(".f-img-wrap").remove(),this.refreshImageList(!0),this.hide(),this.saveUndoStep(),this.callback("afterRemoveImage",[s]),this.focus()}}else i.find("img").click()},e.prototype.setImageAlt=function(t){t.find("img").attr("alt",this.$image_editor.find('.f-image-alt input[type="text"]').val()),t.find("img").attr("title",this.$image_editor.find('.f-image-alt input[type="text"]').val()),this.saveUndoStep(),this.hide(),this.closeImageMode(),this.callback("setImageAlt")},e.prototype.getSelectionTextInfo=function(t){var e,i,n=!1,o=!1;if(window.getSelection){var s=window.getSelection();s.rangeCount&&(e=s.getRangeAt(0),i=e.cloneRange(),i.selectNodeContents(t),i.setEnd(e.startContainer,e.startOffset),n=""===i.toString(),i.selectNodeContents(t),i.setStart(e.endContainer,e.endOffset),o=""===i.toString())}else document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange(),i=e.duplicate(),i.moveToElementText(t),i.setEndPoint("EndToStart",e),n=""===i.text,i.moveToElementText(t),i.setEndPoint("StartToEnd",e),o=""===i.text);return{atStart:n,atEnd:o}},e.prototype.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},e.prototype.initElement=function(e){"TEXTAREA"==e.tagName?(this.$textarea=t(e),void 0!==this.$textarea.attr("placeholder")&&"Type something"==this.options.placeholder&&(this.options.placeholder=this.$textarea.attr("placeholder")),this.$element=t("<div>").html(this.$textarea.val()),this.$textarea.before(this.$element).hide(),this.$textarea.on("submit",t.proxy(function(){this.sync()},this))):"IMG"==e.tagName?("A"==t(e).parent().tagName&&(e=t(e).parent()),this.isImage=!0,this.imageList=[],this.options.paragraphy=!1,this.options.imageMargin="auto",t(e).wrap("<div>"),this.$element=t(e).parent(),this.$element.css("display","inline-block"),this.$element.css("max-width","100%"),this.$element.css("margin","auto")):("DIV"!=e.tagName&&this.options.buttons.indexOf("formatBlock")>=0&&this.disabledList.push("formatBlock"),this.$element=t(e)),this.isImage||(this.$box=this.$element,this.$element=t("<div>"),this.setHTML(this.$box.html(),!1),this.$box.empty(),this.$box.html(this.$element).addClass("froala-box"),this.$element.on("keydown",t.proxy(function(e){var i=e.which,n=["PRE","BLOCKQUOTE"],o=this.getSelectionElements()[0];if(13==i&&""===this.text()&&n.indexOf(o.tagName)>=0)if(this.getSelectionTextInfo(o).atEnd&&!e.shiftKey){e.preventDefault();var s=t("<p><br></p>");t(o).after(s),this.setSelection(s.get(0),0,null,0)}else(this.browser.webkit||this.browser.msie)&&(e.preventDefault(),this.insertHTML(this.endsWith(t(o).html(),"<br>")||!this.getSelectionTextInfo(o).atEnd?"<br>":"<br><br>"))},this)),this.$element.on("keyup",t.proxy(function(e){this.refreshButtons();var i=e.which;if(13==i&&""===this.text()&&this.browser.safari){var n=t(this.getSelectionElement());if(n.parent("li").length){this.saveSelectionByMarkers(),n.before('<span id="li-before"></span>'),n.after('<span id="li-after"></span>');var o=this.$element.html();o=o.replace(/<span id=\"li-before\"><\/span>/g,"</li><li>"),o=o.replace(/<span id=\"li-after\"><\/span>/g,"</li>"),this.$element.html(o),this.restoreSelectionByMarkers()}}13==i&&this.webkitParagraphy()},this))),this.trackHTML=this.getHTML(),this.sync(),this.$element.on("drop",function(){setTimeout(function(){t("html").click()},1)})},e.prototype.webkitParagraphy=function(){this.$element.find("*").each(t.proxy(function(e,i){if(this.emptyElement(i)&&"DIV"==i.tagName&&this.options.paragraphy===!0){var n=t("<p><br/></p>");t(i).replaceWith(n),this.setSelection(n.get(0),0,null,0)}},this))},e.prototype.refreshImageList=function(e){this.addImageWrapper();var i=[];if(this.$element.find("img").each(function(e,n){i.push(t(n).attr("src"))}),void 0===e)for(var n=0;n<this.imageList.length;n++)i.indexOf(this.imageList[n])<0&&this.callback("afterRemoveImage",[this.imageList[n]],!1);this.imageList=i},e.prototype.trim=function(t){return String(t).replace(/^\s+|\s+$/g,"")},e.prototype.unwrapText=function(){this.options.paragraphy||this.$element.find("div").each(function(e,i){void 0===t(i).attr("style")&&t(i).replaceWith(t(i).html()+"<br/>")})},e.prototype.wrapText=function(){if(this.isImage)return!1;this.webkitParagraphy();var i=[],n=["SPAN","A","B","I","EM","U","S","STRONG","STRIKE","FONT"],o=this,s=function(){var e;if(e=t(o.options.paragraphy===!0?"<p>":"<div>"),1==i.length&&("marker-false"===t(i[0]).attr("id")||"marker-true"===t(i[0]).attr("id")||""===t(i[0]).text()))return void(i=[]);for(var n in i)e.append(t(i[n]).clone()),n==i.length-1?t(i[n]).replaceWith(e):t(i[n]).remove();i=[]};this.$element.contents().filter(function(){this.nodeType==Node.TEXT_NODE&&t(this).text().trim().length>0||n.indexOf(this.tagName)>=0?i.push(this):this.nodeType==Node.TEXT_NODE&&0===t(this).text().trim().length?t(this).remove():s()}),s(),this.options.paragraphy&&this.$element.find("img").each(t.proxy(function(i,n){for(var o=t(n).parent();o.get(0)!=this.$element.get(0);){if(e.VALID_NODES.indexOf(o.get(0).tagName)>=0)return!0;o=o.parent()}t(n).parents(".f-img-wrap").length>0?t(n).parents(".f-img-wrap").wrap("<p></p>"):t(n).wrap("<p></p>")},this)),this.$element.find("> p, > div").each(function(e,i){0===t(i).text().trim().length&&0===t(i).find("img").length&&0===t(i).find("br").length&&t(i).append("<br/>")}),this.$element.find("div:empty, > br").remove()},e.prototype.setHTML=function(t,e){void 0===e&&(e=!0),this.options.enableScript||(t=this.stripScript(t)),this.$element.html(this.clean(t,!0,!1)),this.imageList=[],this.refreshImageList(),this.options.paragraphy&&this.wrapText(),e===!0&&this.sync()},e.prototype.registerPaste=function(){var e=this;this.$element.get(0).onpaste=function(){if(!e.isHTML){if(e.callback("beforePaste",[],!1)!==!0)return!1;e.pasting=!0,e.saveSelectionByMarkers();var i=t(window).scrollTop(),n=t('<div contenteditable="true"></div>').appendTo("body").focus();window.setTimeout(function(){var o=n.html();n.remove(),t(window).scrollTop(i),e.restoreSelectionByMarkers(),e.insertHTML(e.options.plainPaste?t("<div>").html(o).text():e.clean(o,!1,!0)),e.sync(),e.$element.trigger("placeholderCheck"),e.pasting=!1,e.callback("afterPaste")},1)}}},e.prototype._extractContent=function(t){for(var e,i=document.createDocumentFragment();e=t.firstChild;)i.appendChild(e);return i},e.prototype.clean=function(e,i,n){var o=["title","href","alt","src","style","width","height","target","rel","name","value","type"],s=["PRE","BLOCKQUOTE"];i===!0&&(o.push("id"),o.push("class"));var a=this,r=t("<div>").html(e);return r.find("*").each(function(e,i){s.indexOf(i.tagName)>=0&&t(i).html(t(i).text()),t.each(i.attributes,function(){void 0!==this&&o.indexOf(this.name)<0&&0!==this.name.indexOf("data-")&&t(i).removeAttr(this.name)}),n===!0&&t(i).removeAttr("style"),"A"==i.tagName&&t(i).attr("href",a.sanitizeURL(t(i).attr("href")))}),this.cleanNewLine(r.html())},e.prototype.cleanNewLine=function(t){var e=new RegExp("\\n","g");return t.replace(e,"")},e.prototype.stripScript=function(t){if(this.options.enableScript)return t;var e=document.createElement("div");e.innerHTML=t;for(var i=e.getElementsByTagName("script"),n=i.length;n--;)i[n].parentNode.removeChild(i[n]);return e.innerHTML},e.prototype.initElementStyle=function(){this.isImage||this.$element.attr("contenteditable",!0),this.$element.addClass("froala-element").addClass(this.options.editorClass),this.$element.css("outline",0),this.browser.msie||this.$element.addClass("not-msie")},e.prototype.initUndoRedo=function(){(this.isEnabled("undo")||this.isEnabled("redo"))&&(this.undoStack=[],this.undoIndex=0,this.saveUndoStep()),this.disableBrowserUndo()},e.prototype.enableTyping=function(){this.typingTimer=null,this.$element.on("keydown",t.proxy(function(){clearTimeout(this.typingTimer),this.ajaxSave=!1,this.oldHTML=this.$element.html(),this.typingTimer=setTimeout(t.proxy(function(){this.$element.html()!=this.oldHTML&&((this.isEnabled("undo")||this.isEnabled("redo"))&&this.$element.html()!=this.undoStack[this.undoIndex-1]&&this.saveUndoStep(),this.sync())},this),Math.max(this.options.typingTimer,200))},this))},e.prototype.getHTML=function(e){if(this.isHTML)return this.$html_area.val();var i=this.$element.clone();this.html5Compliant(i),this.syncClean(i,e),i.find(".f-img-editor > img").each(function(e,i){t(i).css("margin-left",t(i).parent().css("margin-left")),t(i).css("margin-right",t(i).parent().css("margin-right")),t(i).css("margin-bottom",t(i).parent().css("margin-bottom")),t(i).css("margin-top",t(i).parent().css("margin-top")),t(i).siblings("span.f-img-handle").remove().end().unwrap()}),i.find(".f-img-wrap").removeAttr("contenteditable"),this.isImage&&i.find(".f-img-wrap").each(function(e,i){t(i).replaceWith(t(i).html())}),void 0===e&&i.find("span#marker-true, span#marker-false").remove(),i.find("a:empty").remove();var n=i.html();return n.replace(/\u200B/g,"")},e.prototype.getText=function(){return this.$element.text()},e.prototype.initAjaxSaver=function(){this.ajaxHTML=this.getHTML(),this.ajaxSave=!0,this.ajaxInterval=setInterval(t.proxy(function(){this.ajaxHTML!=this.getHTML()&&this.ajaxSave&&(this.options.autosave&&this.save(),this.ajaxHTML=this.getHTML()),this.ajaxSave=!0},this),Math.max(this.options.autosaveInterval,100))
},e.prototype.disableBrowserUndo=function(){t("body").keydown(function(t){var e=t.which,i=t.ctrlKey||t.metaKey;if(!this.isHTML&&i){if(75==e)return t.preventDefault(),!1;if(90==e&&t.shiftKey)return t.preventDefault(),!1;if(90==e)return t.preventDefault(),!1}})},e.prototype.saveUndoStep=function(){if(this.isEnabled("undo")||this.isEnabled("redo")){for(;this.undoStack.length>this.undoIndex;)this.undoStack.pop();this.selectionInEditor()&&this.$element.is(":focus")&&this.saveSelectionByMarkers(),this.undoStack.push(this.getHTML(!0)),this.undoIndex++,this.selectionInEditor()&&this.$element.is(":focus")&&this.restoreSelectionByMarkers(),this.refreshUndoRedo()}},e.prototype.initShortcuts=function(){this.options.shortcuts&&this.$element.on("keydown",t.proxy(function(t){var e=t.which,i=t.ctrlKey||t.metaKey;if(!this.isHTML&&i){if(70==e)return this.show(null),!1;if(66==e)return this.execDefaultShortcut("bold");if(73==e)return this.execDefaultShortcut("italic");if(85==e)return this.execDefaultShortcut("underline");if(75==e)return this.execDefaultShortcut("createLink");if(80==e)return this.repositionEditor(),this.execDefaultShortcut("insertImage");if(65==e)return this.execDefaultShortcut("selectAll");if(221==e)return this.execDefaultShortcut("indent");if(219==e)return this.execDefaultShortcut("outdent");if(72==e)return this.execDefaultShortcut("html");if(48==e)return this.execDefaultShortcut("formatBlock","n");if(49==e)return this.execDefaultShortcut("formatBlock","h1");if(50==e)return this.execDefaultShortcut("formatBlock","h2");if(51==e)return this.execDefaultShortcut("formatBlock","h3");if(52==e)return this.execDefaultShortcut("formatBlock","h4");if(53==e)return this.execDefaultShortcut("formatBlock","h5");if(54==e)return this.execDefaultShortcut("formatBlock","h6");if(222==e)return this.execDefaultShortcut("formatBlock","blockquote");if(220==e)return this.execDefaultShortcut("formatBlock","pre");if(46==e||8==e)return this.execDefaultShortcut("strikeThrough");if(90==e&&t.shiftKey)return this.redo(),t.stopPropagation(),!1;if(90==e)return this.undo(),t.stopPropagation(),!1}9!=e||t.shiftKey?9==e&&t.shiftKey&&t.preventDefault():(t.preventDefault(),this.insertHTML("&nbsp;&nbsp;&nbsp;&nbsp;",!1))},this))},e.prototype.textEmpty=function(e){return(""===t(e).text()||e===this.$element.get(0))&&0===t(e).find("br").length},e.prototype.focus=function(){if(!this.isHTML&&(this.$element.focus(),""===this.text())){var t,i,n=this.getSelectionElements();for(t in n)if(i=n[t],!this.textEmpty(i))return void this.setSelection(i,0,null,0);n=this.$element.find(e.VALID_NODES.join(","));for(t in n)if(i=n[t],!this.textEmpty(i))return void this.setSelection(i,0,null,0);this.setSelection(this.$element.get(0),0,null,0)}},e.prototype.insertHTML=function(t,e){this.isHTML||(this.$element.focus(),this.selectionInEditor()||this.setSelection(this.$element.get(0),0,null,0));var i,n;if(window.getSelection){if(i=window.getSelection(),i.getRangeAt&&i.rangeCount){n=i.getRangeAt(0),n.deleteContents();var o=document.createElement("div");o.innerHTML=t;for(var s,a,r=document.createDocumentFragment();s=o.firstChild;)a=r.appendChild(s);var h=r.firstChild;n.insertNode(r),a&&(n=n.cloneRange(),n.setStartAfter(a),e?n.setStartBefore(h):n.collapse(!0),i.removeAllRanges(),i.addRange(n))}}else if((i=document.selection)&&"Control"!=i.type){var l=i.createRange();l.collapse(!0),i.createRange().pasteHTML(t),e&&(n=i.createRange(),n.setEndPoint("StartToStart",l),n.select())}},e.prototype.execDefaultShortcut=function(t,e){return this.isEnabled(t)?(this.exec(t,e),!1):!0},e.prototype.initEditor=function(){this.$editor=t("<div>"),this.$editor.addClass("froala-editor").hide(),t("body").append(this.$editor),this.options.inlineMode?this.initInlineEditor():this.initBasicEditor()},e.prototype.toolbarTop=function(){t(window).on("scroll resize",t.proxy(function(){this.options.toolbarFixed||this.options.inlineMode||(t(window).scrollTop()>this.$box.offset().top&&t(window).scrollTop()<this.$box.offset().top+this.$box.height()?(this.$editor.addClass("f-scroll"),this.$box.css("padding-top",this.$editor.height()),this.$editor.css("top",t(window).scrollTop()-this.$box.offset().top)):t(window).scrollTop()<this.$box.offset().top&&(this.$editor.removeClass("f-scroll"),this.$box.css("padding-top",""),this.$editor.css("top","")))},this))},e.prototype.initBasicEditor=function(){this.$element.addClass("f-basic"),this.$popup_editor=this.$editor.clone(),this.$popup_editor.appendTo(t("body")),this.$editor.addClass("f-basic").show(),this.$editor.insertBefore(this.$element),this.toolbarTop()},e.prototype.initInlineEditor=function(){this.$popup_editor=this.$editor},e.prototype.initDrag=function(){this.drag_support={filereader:"undefined"!=typeof FileReader,formdata:!!window.FormData,progress:"upload"in new XMLHttpRequest}},e.prototype.initOptions=function(){this.setDimensions(),this.setDirection(),this.setBorderColor(),this.setPlaceholder(),this.setPlaceholderEvents(),this.setSpellcheck(),this.setImageUploadURL(),this.setButtons(),this.setInverseSkin(),this.setTextNearImage(),this.setZIndex()},e.prototype.setImageUploadURL=function(t){t&&(this.options.imageUploadURL=t),this.options.imageUploadToS3&&(this.options.imageUploadURL="https://"+this.options.imageUploadToS3.bucket+"."+this.options.imageUploadToS3.region+".amazonaws.com/")},e.prototype.closeImageMode=function(){this.$element.find("span.f-img-editor > img").each(function(e,i){t(i).css("margin-left",t(i).parent().css("margin-left")),t(i).css("margin-right",t(i).parent().css("margin-right")),t(i).css("margin-bottom",t(i).parent().css("margin-bottom")),t(i).css("margin-top",t(i).parent().css("margin-top")),t(i).siblings("span.f-img-handle").remove().end().unwrap()}),this.$element.find("span.f-img-editor").length&&(this.$element.find("span.f-img-editor").remove(),this.$element.parents("span.f-img-editor").remove()),this.$element.removeClass("f-non-selectable"),this.isImage||this.isHTML||this.$element.attr("contenteditable",!0),this.$image_editor.hide()},e.prototype.isTouch=function(){return WYSIWYGModernizr.touch&&void 0!==window.Touch},e.prototype.initEditorSelection=function(){t(window).on("hide."+this._id,t.proxy(function(){this.hide(!1)},this)),this.$element.on("mousedown touchstart",t.proxy(function(){this.$element.attr("data-resize")||(this.closeImageMode(),this.hide())},this)),this.$element.contextmenu(t.proxy(function(t){return t.preventDefault(),this.options.inlineMode&&this.$element.focus(),!1},this)),this.$element.on("mouseup touchend",t.proxy(function(t){var e=this.text();""===e&&!this.options.alwaysVisible&&(3!=t.which&&2!=t.button||!this.options.inlineMode||this.isImage)||this.isTouch()?this.options.inlineMode||this.refreshButtons():(t.stopPropagation(),this.show(t)),this.imageMode=!1},this)),this.$element.on("mousedown touchstart","img, a",t.proxy(function(t){this.isResizing||this.$element.attr("data-resize")||t.stopPropagation()},this)),this.$element.on("mousedown touchstart",".f-img-handle",t.proxy(function(){this.$element.attr("data-resize",!0)},this)),this.$element.on("mouseup touchend",".f-img-handle",t.proxy(function(){this.$element.removeAttr("data-resize")},this)),this.$editor.on("mouseup touchend",t.proxy(function(t){t.stopPropagation(),this.options.inlineMode===!1&&this.hide()},this)),this.$popup_editor.on("mouseup touchend",t.proxy(function(t){t.stopPropagation()},this)),this.$link_wrapper&&this.$link_wrapper.on("mouseup touchend",t.proxy(function(t){t.stopPropagation()})),this.$image_wrapper&&this.$image_wrapper.on("mouseup touchend",t.proxy(function(t){t.stopPropagation()})),this.$video_wrapper&&this.$video_wrapper.on("mouseup touchend",t.proxy(function(t){t.stopPropagation()})),this.$overlay&&this.$overlay.on("mouseup touchend",t.proxy(function(t){t.stopPropagation()})),this.$image_modal&&this.$image_modal.on("mouseup touchend",t.proxy(function(t){t.stopPropagation()})),t(window).on("mouseup."+this._id,t.proxy(function(){this.selectionInEditor()&&""!==this.text()&&!this.isTouch()?this.show(null):(this.hide(),this.closeImageMode())},this)),t(window).on("mouseup touchend",t.proxy(function(){t(window).trigger("window."+this._id)},this)),t(document).on("selectionchange."+this._id,t.proxy(function(t){if(this.options.inlineMode&&this.selectionInEditor()&&this.link!==!0&&this.isTouch()){var e=this.text();""!==e?(WYSIWYGModernizr.mq("(max-device-width: 320px) and (-webkit-min-device-pixel-ratio: 2)")?this.hide():this.show(null),t.stopPropagation()):this.hide()}},this)),t(document).on("selectionchange",function(e){t(document).trigger("selectionchange."+this._id,[e])}),t(window).bind("keydown."+this._id,t.proxy(function(t){var e=t.which;if(this.imageMode){if(13==e)return this.$element.find(".f-img-editor").parents(".f-img-wrap").before("<br/>"),this.sync(),this.$element.find(".f-img-editor img").click(),!1;if(46==e||8==e)return this.removeImage(this.$element.find(".f-img-editor")),!1}t.ctrlKey||(this.hide(),this.closeImageMode())},this)),t(window).bind("keydown",function(e){t(window).trigger("keydown."+this._id,[e])}),t(window).bind("keyup."+this._id,t.proxy(function(){this.selectionInEditor()&&""!==this.text()&&this.repositionEditor()},this)),t(window).bind("keyup",function(e){t(window).trigger("keyup."+this._id,[e])})},e.prototype.setTextNearImage=function(t){void 0!==t&&(this.options.textNearImage=t),this.options.textNearImage===!0?this.$element.removeClass("f-tni"):this.$element.addClass("f-tni")},e.prototype.setPlaceholder=function(t){t&&(this.options.placeholder=t),this.$textarea&&this.$textarea.attr("placeholder",this.options.placeholder),this.$element.attr("data-placeholder",this.options.placeholder)},e.prototype.isEmpty=function(){var t=this.$element.text().replace(/(\r\n|\n|\r|\t)/gm,"");return""===t&&0===this.$element.find("img, iframe, input").length&&0===this.$element.find("p > br, div > br").length&&0===this.$element.find("li, h1, h2, h3, h4, h5, h6, blockquote, pre").length},e.prototype.fakeEmpty=function(t){void 0===t&&(t=this.$element);var e=t.text().replace(/(\r\n|\n|\r|\t)/gm,"");return""===e&&1==t.find("p, div").length&&1==t.find("p > br, div > br").length&&0===t.find("img, iframe").length},e.prototype.setPlaceholderEvents=function(){this.$element.on("keyup keydown focus placeholderCheck",t.proxy(function(){if(this.pasting)return!1;if(!this.isEmpty()||this.fakeEmpty()||this.isHTML)!this.$element.find("p").length&&this.options.paragraphy?(this.wrapText(),this.$element.find("p, div").length?this.setSelection(this.$element.find("p, div")[0],this.$element.find("p, div").text().length,null,this.$element.find("p, div").text().length):this.$element.removeClass("f-placeholder")):this.fakeEmpty()===!1||this.$element.find(e.VALID_NODES.join(",")).length>1?this.$element.removeClass("f-placeholder"):this.$element.addClass("f-placeholder");else{var i,n=this.selectionInEditor()||this.$element.is(":focus");this.options.paragraphy?(i=t("<p><br/></p>"),this.$element.html(i),n&&this.setSelection(i.get(0),0,null,0),this.$element.addClass("f-placeholder")):this.$element.addClass("f-placeholder")}},this)),this.$element.trigger("placeholderCheck")},e.prototype.setDimensions=function(t,e,i){t&&(this.options.height=t),e&&(this.options.width=e),i&&(this.options.minHeight=i),"auto"!=this.options.height&&this.$element.css("height",this.options.height),"auto"!=this.options.minHeight&&this.$element.css("minHeight",this.options.minHeight),"auto"!=this.options.width&&this.$box.css("width",this.options.width)},e.prototype.setDirection=function(t){t&&(this.options.direction=t),"ltr"!=this.options.direction&&"rtl"!=this.options.direction&&(this.options.direction="ltr"),"rtl"==this.options.direction?(this.$element.addClass("f-rtl"),this.$editor.addClass("f-rtl"),this.$popup_editor.addClass("f-rtl")):(this.$element.removeClass("f-rtl"),this.$editor.removeClass("f-rtl"),this.$popup_editor.removeClass("f-rtl"))},e.prototype.setZIndex=function(t){t&&(this.options.zIndex=t),this.$popup_editor.css("z-index",this.options.zIndex),this.$overlay&&this.$overlay.css("z-index",this.options.zIndex+1),this.$image_modal&&this.$image_modal.css("z-index",this.options.zIndex+2)},e.prototype.setBorderColor=function(t){t&&(this.options.borderColor=t);var i=e.hexToRGB(this.options.borderColor);null!==i&&(this.$editor.css("border-color",this.options.borderColor),this.$editor.attr("data-border-color",this.options.borderColor),this.$image_modal&&this.$image_modal.find(".f-modal-wrapper").css("border-color",this.options.borderColor),this.options.inlineMode||this.$element.css("border-color",this.options.borderColor))},e.prototype.setSpellcheck=function(t){void 0!==t&&(this.options.spellcheck=t),this.$element.attr("spellcheck",this.options.spellcheck)},e.prototype.setInverseSkin=function(t){void 0!==t&&(this.options.inverseSkin=t),this.options.inverseSkin?(this.$editor.addClass("f-inverse"),this.$popup_editor.addClass("f-inverse")):(this.$editor.removeClass("f-inverse"),this.$popup_editor.removeClass("f-inverse"))},e.prototype.customizeText=function(e){if(e){var i=this.$editor.find("[title]").add(this.$popup_editor.find("[title]"));this.$image_modal&&(i=i.add(this.$image_modal.find("[title]"))),i.each(t.proxy(function(i,n){for(var o in e)t(n).attr("title").toLowerCase()==o.toLowerCase()&&t(n).attr("title",e[o])},this)),i=this.$editor.find('[data-text="true"]').add(this.$popup_editor.find('[data-text="true"]')),this.$image_modal&&(i=i.add(this.$image_modal.find('[data-text="true"]'))),i.each(t.proxy(function(i,n){for(var o in e)t(n).text().toLowerCase()==o.toLowerCase()&&t(n).text(e[o])},this))}},e.prototype.setLanguage=function(e){void 0!==e&&(this.options.language=e),t.Editable.LANGS[this.options.language]&&(this.customizeText(t.Editable.LANGS[this.options.language].translation),t.Editable.LANGS[this.options.language].direction&&this.setDirection(t.Editable.LANGS[this.options.language].direction),t.Editable.LANGS[this.options.language].translation[this.options.placeholder]&&this.setPlaceholder(t.Editable.LANGS[this.options.language].translation[this.options.placeholder]))},e.prototype.setCustomText=function(t){t&&(this.options.customText=t),this.options.customText&&this.customizeText(this.options.customText)},e.prototype.execHTML=function(){this.html()},e.prototype.initHTMLArea=function(){this.$html_area=t('<textarea wrap="hard">').keydown(function(e){var i=e.keyCode||e.which;if(9==i){e.preventDefault();var n=t(this).get(0).selectionStart,o=t(this).get(0).selectionEnd;t(this).val(t(this).val().substring(0,n)+"	"+t(this).val().substring(o)),t(this).get(0).selectionStart=t(this).get(0).selectionEnd=n+1}})},e.prototype.setButtons=function(i){i&&(this.options.buttons=i),this.$bttn_wrapper=t("<div>").addClass("bttn-wrapper"),this.$editor.append(this.$bttn_wrapper);for(var n in this.options.buttons){var o,s;"sep"==this.options.buttons[n]&&this.$bttn_wrapper.append(this.options.inlineMode?'<div class="f-clear"></div><hr/>':'<span class="f-sep"></span>');var a=e.commands[this.options.buttons[n]];if(void 0!==a)switch(a.cmd=this.options.buttons[n],a.cmd){case"color":o=this.buildDropdownColor(a),s=this.buildDropdownButton(a,"fr-color-picker").append(o),this.$bttn_wrapper.append(s);break;case"align":o=this.buildDropdownAlign(a),s=this.buildDropdownButton(a,"fr-selector").append(o),this.$bttn_wrapper.append(s);break;case"fontSize":o=this.buildDropdownFontsize(a),s=this.buildDropdownButton(a).append(o),this.$bttn_wrapper.append(s);break;case"formatBlock":o=this.buildDropdownFormatBlock(a),s=this.buildDropdownButton(a).append(o),this.$bttn_wrapper.append(s);break;case"blockStyle":o=this.buildDropdownBlockStyle(a),s=this.buildDropdownButton(a).append(o),this.$bttn_wrapper.append(s);break;case"fontFamily":o=this.buildDropdownFontFamily(),s=this.buildDropdownButton(a,"fr-family").append(o),this.$bttn_wrapper.append(s);break;case"createLink":s=this.buildDefaultButton(a),this.$bttn_wrapper.append(s);break;case"insertImage":s=this.buildDefaultButton(a),this.$bttn_wrapper.append(s);break;case"insertVideo":s=this.buildDefaultButton(a),this.$bttn_wrapper.append(s),this.buildInsertVideo();break;case"undo":case"redo":s=this.buildDefaultButton(a),this.$bttn_wrapper.append(s),s.prop("disabled",!0);break;case"html":s=this.buildDefaultButton(a),this.$bttn_wrapper.append(s),this.options.inlineMode&&this.$box.append(s.clone(!0).addClass("html-switch").attr("title","Hide HTML").click(t.proxy(this.execHTML,this))),this.initHTMLArea();break;default:s=this.buildDefaultButton(a),this.$bttn_wrapper.append(s)}else{if(a=this.options.customButtons[this.options.buttons[n]],void 0===a){if(a=this.options.customDropdowns[this.options.buttons[n]],void 0===a)continue;s=this.buildCustomDropdown(a),this.$bttn_wrapper.append(s);continue}s=this.buildCustomButton(a),this.$bttn_wrapper.append(s)}}this.buildCreateLink(),this.buildInsertImage(),this.options.mediaManager&&this.buildMediaManager(),this.bindButtonEvents()},e.prototype.buildDefaultButton=function(e){var i=t("<button>").addClass("fr-bttn").attr("title",e.title).attr("data-cmd",e.cmd).attr("data-activeless",e.activeless);return void 0!==this.options.icons[e.cmd]?this.prepareIcon(i,this.options.icons[e.cmd]):this.addButtonIcon(i,e),i},e.prototype.prepareIcon=function(t,e){"font"==e.type?this.addButtonIcon(t,{icon:e.value}):"img"==e.type?this.addButtonIcon(t,{icon_img:e.value,title:t.attr("title")}):"txt"==e.type&&this.addButtonIcon(t,{icon_txt:e.value})},e.prototype.addButtonIcon=function(e,i){e.append(i.icon?t("<i>").addClass(i.icon):i.icon_alt?t("<i>").addClass("for-text").html(i.icon_alt):i.icon_img?t('<img src="'+i.icon_img+'">').attr("alt",i.title):i.icon_txt?t("<i>").html(i.icon_txt):i.title)},e.prototype.buildCustomButton=function(e){var i=t("<button>").addClass("fr-bttn").attr("title",e.title);return this.prepareIcon(i,e.icon),i.on("click touchend",t.proxy(function(t){t.stopPropagation(),t.preventDefault(),e.callback(this)},this)),i},e.prototype.buildCustomDropdown=function(e){var i=t("<div>").addClass("fr-bttn fr-dropdown"),n=t("<button>").addClass("fr-trigger").attr("title",e.title);this.prepareIcon(n,e.icon),i.append(n);var o=t("<ul>").addClass("fr-dropdown-menu");for(var s in e.options){var a=t("<li>").append(t('<a href="#">').append(s).on("click touch",e.options[s]));o.append(a)}return i.append(o)},e.prototype.buildDropdownButton=function(e,i){i=i||"";var n=t("<div>").addClass("fr-bttn fr-dropdown").addClass(i),o=t("<button>").addClass("fr-trigger").attr("title",e.title);return this.addButtonIcon(o,e),n.append(o),n},e.prototype.buildDropdownColor=function(e){var i=t("<div>").addClass("fr-dropdown-menu");for(var n in e.seed){var o=e.seed[n],s=t("<div>").append(t('<p data-text="true">').html(o.title));for(var a in o.value){var r=o.value[a];s.append(t("<button>").addClass("fr-color-bttn").attr("data-cmd",o.cmd).attr("data-val",r).attr("data-activeless",e.activeless).css("background-color",r).html("&nbsp;")),a%8==7&&a>0&&(s.append("<hr/>"),(7==a||15==a)&&s.append(t("<div>").addClass("separator")))}i.append(s)}return i},e.prototype.buildDropdownAlign=function(e){var i=t("<ul>").addClass("fr-dropdown-menu");for(var n in e.seed){var o=e.seed[n],s=t("<li>").append(t("<button>").addClass("fr-bttn").attr("data-cmd",o.cmd).attr("title",o.title).attr("data-activeless",e.activeless).append(t("<i>").addClass(o.icon)));i.append(s)}return i},e.prototype.buildDropdownFontsize=function(e){var i=t("<ul>").addClass("fr-dropdown-menu f-font-sizes");for(var n in e.seed)for(var o=e.seed[n],s=o.min;s<=o.max;s++){var a=t("<li>").attr("data-cmd",e.cmd).attr("data-val",s+"px").attr("data-activeless",e.activeless).append(t('<a href="#">').append(t("<span>").text(s+"px")));i.append(a)}return i},e.prototype.buildDropdownFormatBlock=function(e){var i=t("<ul>").addClass("fr-dropdown-menu");for(var n in e.seed){var o=e.seed[n];if(-1!=t.inArray(o.value,this.options.blockTags)){var s=t("<li>").append(t("<li>").attr("data-cmd",e.cmd).attr("data-val",o.value).attr("data-activeless",e.activeless).append(t('<a href="#" data-text="true">').addClass("format_"+o.value).attr("title",o.title).text(o.title)));i.append(s)}}return i},e.prototype.buildDropdownBlockStyle=function(){var e=t("<ul>").addClass("fr-dropdown-menu fr-block-style");return e.append(t('<li data-cmd="blockStyle" data-val="*">').append(t('<a href="#" data-text="true">').text("Default"))),e},e.prototype.buildDropdownFontFamily=function(){var e=t("<ul>").addClass("fr-dropdown-menu");for(var i in this.options.fontList){var n=this.options.fontList[i],o=t("<li>").attr("data-cmd","fontFamily").attr("data-val",n).append(t('<a href="#" data-text="true">').attr("title",n).css("font-family",n).text(n));e.append(o)}return e},e.prototype.buildMediaManager=function(){this.$image_modal=t("<div>").addClass("froala-modal").appendTo("body"),this.$overlay=t("<div>").addClass("froala-overlay").appendTo("body");var i=t("<div>").addClass("f-modal-wrapper").appendTo(this.$image_modal);t("<h4>").append('<span data-text="true">Manage images</span>').append(t('<i class="fa fa-times" title="Cancel">').click(t.proxy(function(){this.hideMediaManager()},this))).appendTo(i),this.$preloader=t('<img src="'+this.options.preloaderSrc+'" alt="Loading..."/>').addClass("f-preloader").appendTo(i),this.$preloader.hide(),this.$media_images=t("<div>").addClass("f-image-list").appendTo(i),WYSIWYGModernizr.touch&&this.$media_images.addClass("f-touch"),this.$media_images.on("click touch","img",t.proxy(function(e){e.stopPropagation();var i=e.currentTarget;this.writeImage(t(i).attr("src")),this.hideMediaManager()},this)),this.$media_images.on("click touchend",".f-delete-img",t.proxy(function(i){i.stopPropagation();var n=t(i.currentTarget).prev(),o="Are you sure? Image will be deleted.";e.LANGS[this.options.language]&&(o=e.LANGS[this.options.language].translation[o]),confirm(o)&&this.callback("beforeDeleteImage",[t(n).attr("src")],!1)!==!1&&(t(n).remove(),this.deleteImage(t(n).attr("src")))},this)),this.hideMediaManager()},e.prototype.deleteImage=function(e){this.options.imageDeleteURL?t.post(this.options.imageDeleteURL,t.extend({src:e},this.options.imageDeleteParams),t.proxy(function(t){this.callback("imageDeleteSuccess",[t],!1)},this)):this.callback("imageDeleteError",["Missing imageDeleteURL option."],!1)},e.prototype.loadImage=function(i){var n=new Image,o=t("<div>").addClass("f-empty");n.onload=t.proxy(function(){var t="Delete";e.LANGS[this.options.language]&&(t=e.LANGS[this.options.language].translation[t]),o.append('<img src="'+i+'"/><a class="f-delete-img"><span data-text="true">'+t+"</span></a>"),o.removeClass("f-empty"),this.$media_images.hide(),this.$media_images.show(),this.callback("imageLoaded",[i],!1)},this),n.onerror=t.proxy(function(){o.remove(),this.throwImageError(1)},this),n.src=i,this.$media_images.append(o)},e.prototype.processLoadedImages=function(t){try{var e=t;this.$media_images.empty();for(var i=0;i<e.length;i++)this.loadImage(e[i])}catch(n){this.throwImageError(4)}},e.prototype.loadImages=function(){this.$preloader.show(),this.$media_images.empty(),this.options.imagesLoadURL?t.get(this.options.imagesLoadURL,this.options.imagesLoadParams,t.proxy(function(t){this.callback("imagesLoaded",[t],!1),this.processLoadedImages(t),this.$preloader.hide()},this),"json").fail(t.proxy(function(){this.callback("imagesLoadError",["Load request failed."],!1),this.$preloader.hide()},this)):(this.callback("imagesLoadError",["Missing imagesLoadURL option."],!1),this.$preloader.hide())},e.prototype.showMediaManager=function(){this.$image_modal.show(),this.$overlay.show(),this.loadImages(),t("body").css("overflow","hidden")},e.prototype.hideMediaManager=function(){this.$image_modal.hide(),this.$overlay.hide(),t("body").css("overflow","")},e.prototype.buildInsertImage=function(){this.$image_wrapper=t("<div>").addClass("image-wrapper"),this.$popup_editor.append(this.$image_wrapper);var i=this;this.$progress_bar=t('<p class="f-progress">').append("<span></span>");var n=null;if(this.options.imageUpload){if(n=t('<div class="f-upload">').append('<strong data-text="true">Drop Image</strong><br>(<span data-text="true">or click</span>)').append(t('<form method="post" action="'+this.options.imageUploadURL+'" encoding="multipart/form-data" enctype="multipart/form-data" target="frame-'+this._id+'">').append(t('<input type="file" accept="image/*" name="'+this.options.imageUploadParam+'" />'))),this.browser.msie&&e.getIEversion()<=9&&null!==n){this.$upload_frame=t('<iframe id="frame-'+this._id+'" name="frame-'+i._id+'" src="javascript:false;" style="width:0; height:0; border:0px solid #FFF;" data-loaded="true">'),n.find("form").append(this.$upload_frame);var o=this.$upload_frame.bind("load",function(){o.unbind("load"),o.bind("load",function(){try{if(i.options.imageUploadToS3){var e=n.find("form").attr("action"),o=n.find('form input[name="key"]').val(),s=e+o;i.writeImage(s),i.options.imageUploadToS3.callback&&i.options.imageUploadToS3.callback.call(this,s,o)}else{var a=t(this).contents().text();i.parseImageResponse(a)}}catch(r){i.throwImageError(7)}})})}this.$image_wrapper.on("change",'input[type="file"]',function(){if(void 0!==this.files)i.uploadFile(this.files),setTimeout(function(){i.showInsertImage()},500);else{var e=t(this).parents("form");e.find('input[type="hidden"]').remove();var n;for(n in i.options.imageUploadParams)e.prepend('<input type="hidden" name="'+n+'" value="'+i.options.imageUploadParams[n]+'" />');if(void 0!==i.options.imageUploadToS3){for(n in i.options.imageUploadToS3.params)e.prepend('<input type="hidden" name="'+n+'" value="'+i.options.imageUploadToS3.params[n]+'" />');e.prepend('<input type="hidden" name="success_action_status" value="201" />'),e.prepend('<input type="hidden" name="X-Requested-With" value="xhr" />'),e.prepend('<input type="hidden" name="Content-Type" value="" />'),e.prepend('<input type="hidden" name="key" value="'+i.options.imageUploadToS3.keyStart+(new Date).getTime()+"-"+t(this).val().match(/[^\/\\]+$/)+'" />')}else e.prepend('<input type="hidden" name="XHR_CORS_TRARGETORIGIN" value="'+window.location.href+'" />');e.submit(),i.$image_list.hide(),i.$progress_bar.show(),i.$progress_bar.find("span").css("width","100%").text("Please wait!")}}),this.buildDragUpload(n),n=t('<li class="drop-upload">').append(n)}var s=t('<input type="text" placeholder="http://example.com"/>').on("mouseup touchend keydown",t.proxy(function(t){t.stopPropagation()},this)),a=null;this.options.mediaManager&&(a=t('<button class="f-browse">').append('<i class="fa fa-search"></i>').on("click",t.proxy(function(){this.showMediaManager()},this)).find("i").click(t.proxy(function(){this.showMediaManager()},this)).end()),this.$image_list=t("<ul>").append(n).append(t('<li class="url-upload">').append('<label><span data-text="true">Enter URL</span>: </label>').append(s).append(a).append(t('<button class="f-ok" data-text="true">OK</button>').click(t.proxy(function(){this.writeImage(s.val(),!0)},this)))),this.$image_wrapper.append(t("<h4>").append('<span data-text="true">Insert image</span>').append(t('<i class="fa fa-times" title="Cancel">').click(t.proxy(function(){this.$bttn_wrapper.show(),this.hideImageWrapper(!0),this.restoreSelection(),this.options.inlineMode||this.imageMode?this.imageMode&&this.showImageEditor():this.hide()},this)))).append(this.$image_list).append(this.$progress_bar).click(function(t){t.stopPropagation()}).find("*").click(function(t){t.stopPropagation()}).end().hide()},e.prototype.writeVideo=function(t){this.$element.focus(),this.restoreSelection(),this.insertHTML(this.stripScript(t)),this.saveUndoStep(),this.$bttn_wrapper.show(),this.hideVideoWrapper(),this.hide(),this.callback("insertVideo",[t])},e.prototype.buildInsertVideo=function(){this.$video_wrapper=t("<div>").addClass("video-wrapper"),this.$popup_editor.append(this.$video_wrapper);var e=t('<textarea placeholder="Embeded code">').on("mouseup touchend keydown",t.proxy(function(t){t.stopPropagation()},this)),i=t("<p>").append(t('<button class="f-ok" data-text="true">OK</button>').click(t.proxy(function(){this.writeVideo(e.val())},this)));this.$video_wrapper.append(t("<h4>").append('<span data-text="true">Insert video</span>').append(t('<i class="fa fa-times" title="Cancel">').click(t.proxy(function(){this.$bttn_wrapper.show(),this.hideVideoWrapper(),this.restoreSelection(),this.options.inlineMode||this.hide()},this)))).append(e).append(i).click(function(t){t.stopPropagation()}).find("*").click(function(t){t.stopPropagation()}).end().hide()},e.prototype.buildCreateLink=function(){this.$link_wrapper=t("<div>").addClass("link-wrapper"),this.$popup_editor.append(this.$link_wrapper);var e=t('<input type="text">').attr("placeholder","http://www.example.com").on("mouseup touchend keydown",function(t){t.stopPropagation()}),i=t('<input type="checkbox" id="f-checkbox-'+this._id+'">').click(function(t){t.stopPropagation()}),n=t('<button class="f-ok" type="button" data-text="true">').text("OK").on("touchend",function(t){t.stopPropagation()}).click(t.proxy(function(){this.writeLink(e.val(),i.prop("checked"))},this)),o=t('<button class="f-ok f-unlink" data-text="true" type="button">').text("UNLINK").on("click touch",t.proxy(function(){this.link=!0,this.writeLink("",i.prop("checked"))},this));this.$link_wrapper.append(t("<h4>").append('<span data-text="true">Insert link</span>').append(t('<i class="fa fa-times" title="Cancel">').click(t.proxy(function(){this.$bttn_wrapper.show(),this.hideLinkWrapper(),this.options.inlineMode||this.imageMode?this.imageMode&&this.showImageEditor():this.hide(),this.restoreSelection()},this)))).append(e).append(t("<p>").append(i).append(' <label for="f-checkbox-'+this._id+'" data-text="true">Open in new tab</label>').append(n).append(o)).end().hide()},e.prototype.buildDragUpload=function(e){var i=this;e.on({dragover:function(){return t(this).addClass("f-hover"),!1},dragend:function(){return t(this).removeClass("f-hover"),!1},drop:function(e){t(this).removeClass("f-hover"),e.preventDefault(),i.uploadFile(e.originalEvent.dataTransfer.files)}})},e.prototype.hideImageLoader=function(){this.$progress_bar.hide(),this.$progress_bar.find("span").css("width","0%").text(""),this.$image_list.show()},e.prototype.writeImage=function(e,i){i&&(e=this.sanitizeURL(e));var n=new Image;return n.onerror=t.proxy(function(){this.hideImageLoader(),this.throwImageError(1)},this),this.imageMode?(n.onload=t.proxy(function(){this.$element.find(".f-img-editor > img").attr("src",e),this.hide(),this.hideImageLoader(),this.$image_editor.show(),this.saveUndoStep(),this.callback("replaceImage",[e])},this),n.src=e,!1):(n.onload=t.proxy(function(){this.$element.focus(),this.restoreSelection(),this.callback("imageLoaded",[e],!1);var i='<img alt="Image title" src="'+e+'" width="'+this.options.defaultImageWidth+'" style="min-width: 16px; min-height: 16px; margin-bottom: '+this.options.imageMargin+"px; margin-left: auto; margin-right: auto; margin-top: "+this.options.imageMargin+'px">',n=this.getSelectionElements()[0];this.getSelectionTextInfo(n).atStart&&n!=this.$element.get(0)?t(n).before("<p>"+i+"</p>"):this.insertHTML(i),this.$element.find("img").each(function(t,e){e.oncontrolselect=function(){return!1}}),this.hide(),this.hideImageLoader(),this.saveUndoStep(),this.callback("insertImage",[e])},this),void(n.src=e))},e.prototype.throwImageError=function(e,i){i="undefined"!=typeof i?i:"undefined";var n="Unknown image upload error.";1==e?n="Bad link.":2==e?n="No link in upload response.":3==e?n="Error during file upload.":4==e?n="Parsing response failed.":5==e?n="Image too large.":6==e?n="Invalid image type.":7==e?n="Image can be uploaded only to same domain in IE 9.":8==e&&(n=i),this.options.imageErrorCallback&&t.isFunction(this.options.imageErrorCallback)&&this.options.imageErrorCallback({errorCode:e,errorStatus:n}),this.hideImageLoader()},e.prototype.uploadFile=function(e){if(this.callback("beforeFileUpload",[e],!1)!==!0)return!1;if(void 0!==e&&e.length>0){var i;if(this.drag_support.formdata&&(i=this.drag_support.formdata?new FormData:null),i){var n;
for(n in this.options.imageUploadParams)i.append(n,this.options.imageUploadParams[n]);if(void 0!==this.options.imageUploadToS3){for(n in this.options.imageUploadToS3.params)i.append(n,this.options.imageUploadToS3.params[n]);i.append("success_action_status","201"),i.append("X-Requested-With","xhr"),i.append("Content-Type",e[0].type),i.append("key",this.options.imageUploadToS3.keyStart+(new Date).getTime()+"-"+e[0].name)}if(i.append(this.options.imageUploadParam,e[0]),e[0].size>this.options.maxImageSize)return this.throwImageError(5),!1;if(this.options.allowedImageTypes.indexOf(e[0].type.replace(/image\//g,""))<0)return this.throwImageError(6),!1}if(i){var o;this.options.crossDomain?o=this.createCORSRequest("POST",this.options.imageUploadURL):(o=new XMLHttpRequest,o.open("POST",this.options.imageUploadURL)),o.onload=t.proxy(function(){this.$progress_bar.find("span").css("width","100%").text("Please wait!");try{200==o.status?this.parseImageResponse(o.responseText):201==o.status?this.parseImageResponseXML(o.responseXML):this.throwImageError(3)}catch(t){this.throwImageError(4)}},this),o.onerror=t.proxy(function(){this.throwImageError(3)},this),o.upload.onprogress=t.proxy(function(t){if(t.lengthComputable){var e=t.loaded/t.total*100|0;this.$progress_bar.find("span").css("width",e+"%")}},this),o.send(i),this.$image_list.hide(),this.$progress_bar.show()}}},e.prototype.parseImageResponse=function(e){try{var i=t.parseJSON(e);i.link?this.writeImage(i.link):i.error?this.throwImageError(8,i.error):this.throwImageError(2)}catch(n){this.throwImageError(4)}},e.prototype.parseImageResponseXML=function(e){try{var i=t(e).find("Location").text(),n=t(e).find("Key").text();this.options.imageUploadToS3.callback.call(this,i,n),i?this.writeImage(i):this.throwImageError(2)}catch(o){this.throwImageError(4)}},e.prototype.createCORSRequest=function(t,e){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(t,e)):i=null,i},e.prototype.writeLink=function(e,i,n){this.options.noFollow&&(n=!0),this.options.alwaysBlank&&(i=!0);var o="",s="";if(n===!0&&(o='rel="nofollow"'),i===!0&&(s='target="_blank"'),e=this.sanitizeURL(e),this.imageMode)return""!==e?("A"!=this.$element.find(".f-img-editor").parent().get(0).tagName?this.$element.find(".f-img-editor").wrap('<a class="f-link" href="'+e+'" '+s+" "+o+"></a>"):(i===!0?this.$element.find(".f-img-editor").parent().attr("target","_blank"):this.$element.find(".f-img-editor").parent().removeAttr("target"),n===!0?this.$element.find(".f-img-editor").parent().attr("rel","nofollow"):this.$element.find(".f-img-editor").parent().removeAttr("rel"),this.$element.find(".f-img-editor").parent().attr("href",e)),this.callback("insertImageLink",[e])):("A"==this.$element.find(".f-img-editor").parent().get(0).tagName&&t(this.$element.find(".f-img-editor").get(0)).unwrap(),this.callback("removeImageLink")),this.saveUndoStep(),this.showImageEditor(),this.$element.find(".f-img-editor").find("img").click(),this.link=!1,!1;if(this.restoreSelection(),document.execCommand("unlink",!1,e),this.saveSelectionByMarkers(),this.$element.find("span.f-link").each(function(e,i){t(i).replaceWith(t(i).html())}),this.restoreSelectionByMarkers(),""!==e){document.execCommand("createLink",!1,e);for(var a=this.getSelectionLinks(),r=0;r<a.length;r++)i===!0&&t(a[r]).attr("target","_blank"),n===!0&&t(a[r]).attr("rel","nofollow"),t(a[r]).addClass("f-link");this.$element.find("a:empty").remove(),this.callback("insertLink",[e])}else this.$element.find("a:empty").remove(),this.callback("removeLink");this.saveUndoStep(),this.hideLinkWrapper(),this.$bttn_wrapper.show(),this.options.inlineMode||this.hide(),this.link=!1},e.prototype.getSelectionLinks=function(){var t,e,i,n,o=[];if(window.getSelection){var s=window.getSelection();if(s.getRangeAt&&s.rangeCount){n=document.createRange();for(var a=0;a<s.rangeCount;++a)if(t=s.getRangeAt(a),e=t.commonAncestorContainer,1!=e.nodeType&&(e=e.parentNode),"a"==e.nodeName.toLowerCase())o.push(e);else{i=e.getElementsByTagName("a");for(var r=0;r<i.length;++r)n.selectNodeContents(i[r]),n.compareBoundaryPoints(t.END_TO_START,t)<1&&n.compareBoundaryPoints(t.START_TO_END,t)>-1&&o.push(i[r])}n.detach()}}else if(document.selection&&"Control"!=document.selection.type)if(t=document.selection.createRange(),e=t.parentElement(),"a"==e.nodeName.toLowerCase())o.push(e);else{i=e.getElementsByTagName("a"),n=document.body.createTextRange();for(var h=0;h<i.length;++h)n.moveToElementText(i[h]),n.compareEndPoints("StartToEnd",t)>-1&&n.compareEndPoints("EndToStart",t)<1&&o.push(i[h])}return o},e.prototype.isEnabled=function(e){return t.inArray(e,this.options.buttons)>=0},e.prototype.show=function(e){if(void 0!==e){if(this.options.inlineMode)if(null!==e&&"touchend"!==e.type){var i=e.pageX,n=e.pageY;i<this.$element.offset().left&&(i=this.$element.offset().left),i>this.$element.offset().left+this.$element.width()&&(i=this.$element.offset().left+this.$element.width()),n<this.$element.offset.top&&(n=this.$element.offset().top),n>this.$element.offset().top+this.$element.height()&&(n=this.$element.offset().top+this.$element.height()),20>i&&(i=20),0>n&&(n=0),i+this.$editor.width()>t(window).width()-50?(this.$editor.addClass("right-side"),i=t(window).width()-(i+30),this.$editor.css("top",n+20),this.$editor.css("right",i),this.$editor.css("left","auto")):(this.$editor.removeClass("right-side"),this.$editor.css("top",n+20),this.$editor.css("left",i-20),this.$editor.css("right","auto")),t(".froala-editor:not(.f-basic)").hide(),this.$editor.show()}else t(".froala-editor:not(.f-basic)").hide(),this.$editor.show(),this.repositionEditor();this.hideLinkWrapper(),this.hideVideoWrapper(),this.hideImageWrapper(),this.$bttn_wrapper.show(),this.$bttn_wrapper.find(".fr-dropdown").removeClass("active"),this.refreshButtons(),this.imageMode=!1}},e.prototype.showByCoordinates=function(e,i){e-=20,i+=15,e+this.$popup_editor.width()>t(window).width()-50?(this.$popup_editor.addClass("right-side"),e=t(window).width()-(e+40),this.$popup_editor.css("top",i),this.$popup_editor.css("right",e),this.$popup_editor.css("left","auto")):(this.$popup_editor.removeClass("right-side"),this.$popup_editor.css("top",i),this.$popup_editor.css("left",e),this.$popup_editor.css("right","auto")),this.$popup_editor.show()},e.prototype.showLinkWrapper=function(){this.$link_wrapper&&(this.$link_wrapper.show(),setTimeout(t.proxy(function(){this.$link_wrapper.find('input[type="text"]').focus().select()},this),0))},e.prototype.hideLinkWrapper=function(){this.$link_wrapper&&this.$link_wrapper.hide()},e.prototype.showImageWrapper=function(){this.$image_wrapper&&this.$image_wrapper.show()},e.prototype.showVideoWrapper=function(){this.$video_wrapper&&this.$video_wrapper.show()},e.prototype.hideImageWrapper=function(t){this.$image_wrapper&&(this.$element.attr("data-resize")||t||this.closeImageMode(),this.$image_wrapper.hide())},e.prototype.hideVideoWrapper=function(){this.$video_wrapper&&this.$video_wrapper.hide()},e.prototype.showInsertLink=function(){this.options.inlineMode&&this.$bttn_wrapper.hide(),this.showLinkWrapper(),this.hideImageWrapper(!0),this.hideVideoWrapper(),this.$image_editor.hide(),this.link=!0},e.prototype.showInsertImage=function(){this.options.inlineMode&&this.$bttn_wrapper.hide(),this.hideLinkWrapper(),this.hideVideoWrapper(),this.showImageWrapper(),this.$image_editor.hide()},e.prototype.showInsertVideo=function(){this.options.inlineMode&&this.$bttn_wrapper.hide(),this.hideLinkWrapper(),this.hideImageWrapper(),this.showVideoWrapper(),this.$image_editor.hide()},e.prototype.showImageEditor=function(){this.options.inlineMode&&this.$bttn_wrapper.hide(),this.hideLinkWrapper(),this.hideImageWrapper(!0),this.hideVideoWrapper(),this.$image_editor.show(),this.options.imageMove||this.$element.attr("contenteditable",!1)},e.prototype.hideOtherEditors=function(){for(var i=1;i<=e.count;i++)i!=this._id&&t(window).trigger("hide."+i)},e.prototype.hide=function(t){void 0===t&&(t=!0),t?this.hideOtherEditors():(this.closeImageMode(),this.imageMode=!1),this.$popup_editor.hide(),this.hideLinkWrapper(),this.hideImageWrapper(),this.hideVideoWrapper(),this.$image_editor.hide(),this.link=!1},e.prototype.positionPopup=function(e){t(this.$editor.find('button.fr-bttn[data-cmd="'+e+'"]')).length&&(this.$popup_editor.css("top",this.$editor.find('button.fr-bttn[data-cmd="'+e+'"]').offset().top+30),this.$popup_editor.css("left",this.$editor.find('button.fr-bttn[data-cmd="'+e+'"]').offset().left),this.$popup_editor.show())},e.prototype.bindButtonEvents=function(){this.bindDropdownEvents(),this.bindCommandEvents(this.$bttn_wrapper.find("[data-cmd]"))},e.prototype.bindDropdownEvents=function(){var e=this;this.$bttn_wrapper.find(".fr-dropdown").on("click touchend",function(i){return i.stopPropagation(),i.preventDefault(),e.options.inlineMode===!1&&e.hide(),t(this).attr("data-disabled")?!1:(t(".fr-dropdown").not(this).removeClass("active"),void t(this).toggleClass("active"))}),t(window).on("click touchend",t.proxy(function(){this.$editor.find(".fr-dropdown").removeClass("active")},this)),this.$element.on("click touchend","img, a",t.proxy(function(){this.$editor.find(".fr-dropdown").removeClass("active")},this));var i=this.$bttn_wrapper.find(".fr-selector button.fr-bttn");i.bind("select",function(){t(this).parents(".fr-selector").find(" > button > i").attr("class",t(this).find("i").attr("class"))}).on("click touch",function(){t(this).parents("ul").find("button").removeClass("active"),t(this).parents(".fr-selector").removeClass("active").trigger("mouseout"),t(this).trigger("select")})},e.prototype.bindCommandEvents=function(e){e.on("touchmove",function(){t(this).data("dragging",!0)}),e.on("click touchend",t.proxy(function(e){e.stopPropagation(),e.preventDefault();var i=e.currentTarget;if(t(i).data("dragging"))return t(i).removeData("dragging"),!1;var n=t(i).data("cmd"),o=t(i).data("val");t(i).parents(".fr-dropdown").removeClass("active"),this.exec(n,o),this.$bttn_wrapper.find(".fr-dropdown").removeClass("active")},this))},e.prototype._startInDefault=function(t){this.$element.focus(),this.$bttn_wrapper.find('[data-cmd="'+t+'"]').toggleClass("active"),document.execCommand(t)},e.prototype._startInFontExec=function(t,e,i){this.$element.focus(),this.insertHTML('<span data-inserted="true" data-font="'+e+'" style="'+t+": "+i+'"></span>',!0);var n=this.$element.find("[data-inserted]");n.removeAttr("data-inserted"),this.setSelection(n.get(0),0,null,0)},e.prototype.exec=function(t,e){if(!this.selectionInEditor()&&"html"!==t&&"undo"!==t&&"redo"!==t&&"selectAll"!==t&&"save"!=t&&"insertImage"!==t&&"insertVideo"!==t)return!1;if(this.selectionInEditor()){if(""===this.text()){if("bold"===t||"italic"===t||"underline"===t||"strikeThrough"==t)return this._startInDefault(t),!1;if("fontSize"==t)return this._startInFontExec("font-size",t,e),!1;if("fontFamily"==t)return this._startInFontExec("font-family",t,e),!1}if(""===this.text()&&"insertHorizontalRule"!=t&&"fontSize"!==t&&"formatBlock"!==t&&"blockStyle"!==t&&"indent"!==t&&"outdent"!==t&&"justifyLeft"!==t&&"justifyRight"!==t&&"justifyFull"!==t&&"justifyCenter"!==t&&"html"!==t&&"undo"!==t&&"redo"!==t&&"selectAll"!==t&&"save"!==t&&"insertImage"!==t&&"insertVideo"!==t&&"insertOrderedList"!==t&&"insertUnorderedList"!==t)return!1}switch(t){case"fontSize":this.fontExec("font-size",t,e);break;case"fontFamily":this.fontExec("font-family",t,e);break;case"backColor":this.backColor(e);break;case"foreColor":this.foreColor(e);break;case"formatBlock":this.formatBlock(e);break;case"blockStyle":this.blockStyle(e);break;case"createLink":this.insertLink();break;case"insertImage":this.insertImage();break;case"indent":this.indent();break;case"outdent":this.outdent(!0);break;case"justifyLeft":case"justifyRight":case"justifyCenter":case"justifyFull":this.align(t);break;case"insertOrderedList":case"insertUnorderedList":this.formatList(t);break;case"insertVideo":this.insertVideo();break;case"indent":case"outdent":this.execDefault(t,e),this.repositionEditor();break;case"undo":this.undo();break;case"redo":this.redo();break;case"html":this.html();break;case"save":this.save();break;case"selectAll":this.$element.focus(),this.execDefault(t,e);break;case"insertHorizontalRule":this.execDefault(t,e),this.hide();break;default:this.execDefault(t,e)}"undo"!=t&&"redo"!=t&&"selectAll"!=t&&"createLink"!=t&&"insertImage"!=t&&"html"!=t&&"insertVideo"!=t&&this.saveUndoStep(),"createLink"!=t&&"insertImage"!=t&&this.refreshButtons()},e.prototype.removeFormat=function(){document.execCommand("removeFormat",!1,!1),document.execCommand("unlink",!1,!1)},e.prototype.undo=function(){if(this.undoIndex>1){var t=this.getHTML(),e=this.undoStack[--this.undoIndex-1];this.$element.html(e),this.$element.focus(),this.restoreSelectionByMarkers(),this.hide(),this.callback("undo",[this.$element.html(),t])}this.refreshUndoRedo()},e.prototype.redo=function(){if(this.undoIndex<this.undoStack.length){var t=this.$element.html(),e=this.undoStack[this.undoIndex++];this.$element.html(e),this.$element.focus(),this.restoreSelectionByMarkers(),this.hide(),this.callback("redo",[this.$element.html(),t])}this.refreshUndoRedo()},e.prototype.save=function(){return this.callback("beforeSave",[],!1)!==!0?!1:void(this.options.saveURL?t.post(this.options.saveURL,t.extend({body:this.getHTML()},this.options.saveParams),t.proxy(function(t){this.callback("afterSave",[t])},this)).fail(t.proxy(function(){this.callback("saveError",["Save request failed on the server."])},this)):this.callback("saveError",["Missing save URL."]))},e.prototype.sanitizeURL=function(t){return this.options.enableScript?t:/^https?:\/\//.test(t)?String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):encodeURIComponent(t).replace("%23","#").replace("%2F","/")},e.prototype.html=function(){var t;this.isHTML?(this.isHTML=!1,t=this.options.enableScript?this.$html_area.val():this.stripScript(this.$html_area.val()),t=this.clean(t,!0,!1),this.$element.html(t).attr("contenteditable",!0),this.$box.removeClass("f-html"),this.$editor.find('.fr-bttn:not([data-cmd="html"])').prop("disabled",!1),this.$editor.find("div.fr-bttn").removeAttr("data-disabled"),this.$editor.find('.fr-bttn[data-cmd="html"]').removeClass("active"),this.saveUndoStep(),this.options.pragraphy&&this.wrapText(),this.refreshButtons(),this.callback("htmlHide",[t]),this.focus()):(t=this.options.inlineMode?"\n\n"+this.getHTML():html_beautify(this.getHTML()),this.$html_area.val(t).trigger("resize"),this.options.inlineMode&&this.$box.find(".html-switch").css("top",this.$box.css("padding-top")),this.$html_area.css("height",this.$element.height()+20),this.$element.html(this.$html_area).removeAttr("contenteditable"),this.$box.addClass("f-html"),this.$editor.find('button.fr-bttn:not([data-cmd="html"])').prop("disabled",!0),this.$editor.find("div.fr-bttn").attr("data-disabled",!0),this.$editor.find('.fr-bttn[data-cmd="html"]').addClass("active"),this.options.inlineMode&&this.hide(),this.isHTML=!0,this.callback("htmlShow",[t]))},e.prototype.beautifyFont=function(e){for(var i=!0,n=t.proxy(function(){this.$element.find('span[data-font="'+e+'"] + span[data-font="'+e+'"]').each(function(n,o){t(o).css(e)==t(o).prev().css(e)&&(t(o).prepend(t(o).prev().html()),t(o).prev().remove(),i=!0)}),this.$element.find('span[data-font="'+e+'"] + span#marker-true + span[data-font="'+e+'"], span[data-font="'+e+'"] + span#marker-false + span[data-font="'+e+'"]').each(function(n,o){t(o).css(e)==t(o).prev().prev().css(e)&&(t(o).prepend(t(o).prev().clone()),t(o).prepend(t(o).prev().prev().html()),t(o).prev().prev().remove(),t(o).prev().remove(),i=!0)})},this);i;)i=!1,n()},e.prototype.fontExec=function(e,i,n){document.execCommand("fontSize",!1,1),this.saveSelectionByMarkers();var o=[];this.$element.find("font").each(function(i,s){var a=t("<span>").attr("data-font",e).css(e,n).html(t(s).html());0===t(s).parents("font").length&&o.push(a),t(s).replaceWith(a)});var s=function(i,n){t(n).css(e,"")};for(var a in o){var r=o[a];t(r).find("*").each(s)}this.$element.find('span[data-font="'+e+'"] > span[data-font="'+e+'"]').each(function(i,n){t(n).attr("style")&&(t(n).before('<span class="close-span"></span>'),t(n).after('<span data-font="'+e+'" style="'+e+": "+t(n).parent().css(e)+';" data-open="true"></span>'))});var h=this.$element.html();h=h.replace(new RegExp('<span class="close-span"></span>',"g"),"</span>"),h=h.replace(new RegExp('data-open="true"></span>',"g"),">"),this.$element.html(h),this.beautifyFont(e),this.$element.find('span[style=""]').each(function(e,i){t(i).replaceWith(t(i).html())}),this.$element.find('span[data-font="'+e+'"]').each(function(i,n){t(n).css(e)==t(n).parent().css(e)&&t(n).replaceWith(t(n).html())}),this.$element.find('span[data-font="'+e+'"]').each(function(e,i){""===t(i).text()&&t(i).replaceWith(t(i).html())}),this.beautifyFont(e),this.restoreSelectionByMarkers(),this.repositionEditor(),this.callback(i,[n])},e.prototype.backColor=function(i){var n="backColor";this.browser.msie||(n="hiliteColor");var o=t(this.getSelectionElement()).css("background-color");document.execCommand(n,!1,i);var s=this.$editor.find('button.fr-color-bttn[data-cmd="backColor"][data-val="'+i+'"]');s.addClass("active"),s.siblings().removeClass("active"),this.callback("backColor",[e.hexToRGBString(i),o])},e.prototype.foreColor=function(i){var n=t(this.getSelectionElement()).css("color");document.execCommand("foreColor",!1,i),this.saveSelectionByMarkers(),this.$element.find("font[color]").each(function(e,n){t(n).replaceWith(t("<span>").css("color",i).html(t(n).html()))}),this.restoreSelectionByMarkers();var o=this.$editor.find('button.fr-color-bttn[data-cmd="foreColor"][data-val="'+i+'"]');o.addClass("active"),o.siblings().removeClass("active"),this.callback("foreColor",[e.hexToRGBString(i),n])},e.prototype.formatBlock=function(e,i){if(this.disabledList.indexOf("formatBlock")>=0)return!1;this.saveSelectionByMarkers(),this.wrapText(),this.restoreSelectionByMarkers();var n=this.getSelectionElements();this.saveSelectionByMarkers();var o;for(var s in n){var a=t(n[s]);if(!this.fakeEmpty(a))if(o="n"==e?this.options.paragraphy?t("<div>").html(a.html()):a.html()+"<br/>":t("<"+e+">").html(a.html()),a.get(0)!=this.$element.get(0)&&"LI"!=a.get(0).tagName){var r=a.prop("attributes");if(o.attr)for(var h in r)"class"!==r[h].name&&o.attr(r[h].name,r[h].value);var l=this.options.blockStyles[e];void 0===l&&(l=this.options.defaultBlockStyle);try{if(void 0!==a.attr("class")&&void 0!==l)for(var p=a.attr("class").split(" "),d=0;d<p.length;d++){var c=p[d];void 0!==l[c]&&void 0===i&&o.addClass(c)}else o.addClass(a.attr("class"));"*"!=i&&o.addClass(i)}catch(u){}a.replaceWith(o)}else a.html(o)}this.unwrapText(),this.restoreSelectionByMarkers(),this.hide(),this.callback("formatBlock")},e.prototype.blockStyle=function(t){var e=this.activeBlockTag();this.formatBlock(e,t)},e.prototype.formatList=function(e){this.saveSelectionByMarkers();var i,n=this.getSelectionElements(),o=!0,s=!1;for(var a in n)if(i=t(n[a]),i.parents("li").length>0||"LI"==i.get(0).tagName){var r;r="LI"==i.get(0).tagName?i:i.parents("li"),i.parents("ol").length>0?(r.before('<span class="close-ol"></span>'),r.after('<span class="open-ol"></span>')):i.parents("ul").length>0&&(r.before('<span class="close-ul"></span>'),r.after('<span class="open-ul"></span>')),r.replaceWith(r.contents()),s=!0}else o=!1;if(s){var h=this.$element.html();h=h.replace(new RegExp('<span class="close-ul"></span>',"g"),"</ul>"),h=h.replace(new RegExp('<span class="open-ul"></span>',"g"),"<ul>"),h=h.replace(new RegExp('<span class="close-ol"></span>',"g"),"</ol>"),h=h.replace(new RegExp('<span class="open-ol"></span>',"g"),"<ol>"),this.$element.html(h),this.$element.find("ul:empty, ol:empty").remove()}if(this.clearSelection(),o===!1){this.wrapText(),this.restoreSelectionByMarkers(),n=this.getSelectionElements(),this.saveSelectionByMarkers();var l=t("<ol>");"insertUnorderedList"==e&&(l=t("<ul>"));for(var p in n)i=t(n[p]),i.get(0)!=this.$element.get(0)&&(l.append(t("<li>").append(i.clone())),p!=n.length-1?i.remove():(i.replaceWith(l),l.find("li")));this.unwrapText()}this.restoreSelectionByMarkers(),this.repositionEditor(),this.callback(e)},e.prototype.align=function(e){var i=this.getSelectionElements();"justifyLeft"==e?e="left":"justifyRight"==e?e="right":"justifyCenter"==e?e="center":"justifyFull"==e&&(e="justify");for(var n in i)t(i[n]).css("text-align",e);this.repositionEditor(),this.callback("align",[e])},e.prototype.indent=function(e){var i=20;e&&(i=-20),this.saveSelectionByMarkers(),this.wrapText(),this.restoreSelectionByMarkers();var n=this.getSelectionElements();this.saveSelectionByMarkers();for(var o in n){var s=t(n[o]);if(s.parentsUntil(this.$element,"li").length>0&&(s=s.parentsUntil(this.$element,"li")),s.get(0)!=this.$element.get(0)){var a=parseInt(s.css("margin-left").replace(/px/,""),10),r=Math.max(0,a+i);s.css("marginLeft",r),"LI"===s.get(0).tagName&&(r%60===0?0===s.parents("ol").length?s.css("list-style-type","disc"):s.css("list-style-type","decimal"):r%40===0?0===s.parents("ol").length?s.css("list-style-type","square"):s.css("list-style-type","lower-latin"):0===s.parents("ol").length?s.css("list-style-type","circle"):s.css("list-style-type","lower-roman"))}else{var h=t("<div>").html(s.html());s.html(h),h.css("marginLeft",Math.max(0,i))}}this.unwrapText(),this.restoreSelectionByMarkers(),this.repositionEditor(),e||this.callback("indent")},e.prototype.outdent=function(){this.indent(!0),this.callback("outdent")},e.prototype.insertLink=function(){this.showInsertLink(),this.options.inlineMode||this.positionPopup("createLink"),this.saveSelection();var e=this.getSelectionLink(),i=this.getSelectionLinks();i.length>0?this.$link_wrapper.find('input[type="checkbox"]').prop("checked","_blank"==t(i[0]).attr("target")):this.$link_wrapper.find('input[type="checkbox"]').prop("checked",this.options.alwaysBlank),this.$link_wrapper.find('input[type="text"]').val(e||"http://")},e.prototype.insertImage=function(){this.showInsertImage(),this.saveSelection(),this.options.inlineMode||this.positionPopup("insertImage"),this.$image_wrapper.find('input[type="text"]').val("")},e.prototype.insertVideo=function(){this.showInsertVideo(),this.saveSelection(),this.options.inlineMode||this.positionPopup("insertVideo"),this.$video_wrapper.find("textarea").val("")},e.prototype.execDefault=function(t,e){document.execCommand(t,!1,e),"insertOrderedList"==t?this.$bttn_wrapper.find('[data-cmd="insertUnorderedList"]').removeClass("active"):"insertUnorderedList"==t&&this.$bttn_wrapper.find('[data-cmd="insertOrderedList"]').removeClass("active"),this.callback(t)},e.prototype.isActive=function(t,e){switch(t){case"fontFamily":return this._isActiveFontFamily(e);case"fontSize":return this._isActiveFontSize(e);case"backColor":return this._isActiveBackColor(e);case"foreColor":return this._isActiveForeColor(e);case"formatBlock":return this._isActiveFormatBlock(e);case"blockStyle":return this._isActiveBlockStyle(e);case"createLink":case"insertImage":return!1;case"justifyLeft":case"justifyRight":case"justifyCenter":case"justifyFull":return this._isActiveAlign(t);case"html":return this._isActiveHTML();case"undo":case"redo":case"save":return!1;default:return this._isActiveDefault(t)}},e.prototype._isActiveFontFamily=function(e){var i=this.getSelectionElement();return t(i).css("fontFamily").replace(/ /g,"")===e.replace(/ /g,"")?!0:!1},e.prototype._isActiveFontSize=function(e){var i=this.getSelectionElement();return t(i).css("fontSize")===e?!0:!1},e.prototype._isActiveBackColor=function(e){for(var i=this.getSelectionElement();t(i).get(0)!=this.$element.get(0);){if(t(i).css("background-color")===e)return!0;if("transparent"!=t(i).css("background-color")&&"rgba(0, 0, 0, 0)"!=t(i).css("background-color"))return!1;i=t(i).parent()}return!1},e.prototype._isActiveForeColor=function(t){return document.queryCommandValue("foreColor")===t?!0:!1},e.prototype._isActiveFormatBlock=function(e){"CODE"===e.toUpperCase()?e="PRE":"N"===e.toUpperCase()&&(e="DIV");for(var i=t(this.getSelectionElement());i.get(0)!=this.$element.get(0);){if(i.get(0).tagName==e.toUpperCase())return!0;i=i.parent()}return!1},e.prototype._isActiveBlockStyle=function(e){for(var i=t(this.getSelectionElement());i.get(0)!=this.$element.get(0);){if(i.hasClass(e))return!0;i=i.parent()}return!1},e.prototype._isActiveAlign=function(e){var i=this.getSelectionElements();return"justifyLeft"==e?e="left":"justifyRight"==e?e="right":"justifyCenter"==e?e="center":"justifyFull"==e&&(e="justify"),e==t(i[0]).css("text-align")?!0:!1},e.prototype._isActiveHTML=function(){return this.isHTML?!0:!1},e.prototype._isActiveDefault=function(t){try{if(document.queryCommandState(t)===!0)return!0}catch(e){}return!1},e.prototype.activeBlockTag=function(){return t('.active[data-cmd="formatBlock"]').data("val")},e.prototype.updateBlockStyles=function(){var e=this.activeBlockTag();this.$bttn_wrapper.find(".fr-block-style").empty(),this.$bttn_wrapper.find(".fr-block-style").append(t('<li data-cmd="blockStyle" data-val="*">').append(t('<a href="#" data-text="true">').text("Default")));var i=this.options.blockStyles[e];if(void 0===i&&(i=this.options.defaultBlockStyle),void 0!==i)for(var n in i){var o=i[n];this.$bttn_wrapper.find(".fr-block-style").append(t("<li>").append(t('<a href="#" data-text="true">').text(o).addClass(n)).attr("data-cmd","blockStyle").attr("data-val",n))}this.bindCommandEvents(this.$bttn_wrapper.find(".fr-block-style [data-cmd]"))},e.prototype.refreshButtons=function(){return!this.selectionInEditor()||this.isHTML?!1:(this.refreshUndoRedo(),this.$bttn_wrapper.find('[data-cmd="formatBlock"]').each(t.proxy(function(t,e){this.refreshFormatBlock(e)},this)),this.updateBlockStyles(),this.$bttn_wrapper.find("[data-cmd]").not('[data-cmd="formatBlock"]').each(t.proxy(function(e,i){switch(t(i).data("cmd")){case"fontSize":this.refreshFontSize(i);break;case"fontFamily":this.refreshFontFamily(i);break;case"backColor":this.refreshBackColor(i);break;case"foreColor":this.refreshForeColor(i);break;case"formatBlock":this.refreshFormatBlock(i);break;case"blockStyle":this.refreshBlockStyle(i);break;case"createLink":case"insertImage":break;case"justifyLeft":case"justifyRight":case"justifyCenter":case"justifyFull":this.refreshAlign(i);break;case"html":this.isActive("html")?t(i).addClass("active"):t(i).removeClass("active");break;case"undo":case"redo":case"save":break;default:this.refreshDefault(i)}},this)),void(0===this.$bttn_wrapper.find(".fr-block-style .active").length&&this.$bttn_wrapper.find(".fr-block-style li:first").addClass("active")))},e.prototype.refreshBlockStyle=function(e){this.disabledList.indexOf("blockStyle")>=0&&t(e).parents(".fr-dropdown").attr("data-disabled",!0),t(e).removeClass("active"),this.isActive(t(e).data("cmd"),t(e).data("val"))&&t(e).addClass("active")},e.prototype.refreshFormatBlock=function(e){this.disabledList.indexOf("formatBlock")>=0&&t(e).parents(".fr-dropdown").attr("data-disabled",!0),t(e).removeClass("active"),this.isActive(t(e).data("cmd"),t(e).data("val"))&&t(e).addClass("active")},e.prototype.refreshUndoRedo=function(){if(this.isEnabled("undo")||this.isEnabled("redo")){if(void 0===this.$editor)return;this.$bttn_wrapper.find('[data-cmd="undo"], [data-cmd="redo"]').prop("disabled",!1),(0===this.undoStack.length||this.undoIndex<=1||this.isHTML)&&this.$bttn_wrapper.find('[data-cmd="undo"]').prop("disabled",!0),(this.undoIndex==this.undoStack.length||this.isHTML)&&this.$bttn_wrapper.find('[data-cmd="redo"]').prop("disabled",!0)}},e.prototype.refreshDefault=function(e){t(e).removeClass("active"),this.isActive(t(e).data("cmd"))&&t(e).addClass("active")},e.prototype.refreshAlign=function(e){var i=t(e).data("cmd");this.isActive(i)&&(t(e).parents("ul").find(".fr-bttn").removeClass("active"),t(e).addClass("active"),t(e).parents(".fr-dropdown").find(".fr-trigger").html(t(e).html()))},e.prototype.refreshForeColor=function(e){t(e).removeClass("active"),this.isActive("foreColor",e.style.backgroundColor)&&t(e).addClass("active")},e.prototype.refreshBackColor=function(e){t(e).removeClass("active"),this.isActive("backColor",e.style.backgroundColor)&&t(e).addClass("active")},e.prototype.refreshFontSize=function(e){t(e).removeClass("active"),this.isActive("fontSize",t(e).data("val"))&&t(e).addClass("active")},e.prototype.refreshFontFamily=function(e){t(e).removeClass("active"),this.isActive("fontFamily",t(e).data("val"))&&t(e).addClass("active")},e.prototype.option=function(e,i){if(void 0===e)return this.options;if(e instanceof Object)this.options=t.extend({},this.options,e),this.initOptions(),this.setCustomText(),this.setLanguage();else{if(void 0===i)return this.options[e];switch(this.options[e]=i,e){case"borderColor":this.setBorderColor();break;case"direction":this.setDirection();break;case"height":case"width":case"minHeight":this.setDimensions();break;case"spellcheck":this.setSpellcheck();break;case"placeholder":this.setPlaceholder();break;case"customText":this.setCustomText();break;case"inverseSkin":this.setInverseSkin();break;case"language":this.setLanguage();break;case"textNearImage":this.setTextNearImage();break;case"zIndex":this.setZIndex()}}};var i=t.fn.editable;t.fn.editable=function(i){for(var n=[],o=0;o<arguments.length;o++)n.push(arguments[o]);if(t("html").data("editable",!0),"string"==typeof i){var s=[];return this.each(function(){var e=t(this),o=e.data("fa.editable"),a=o[i].apply(o,n.slice(1));s.push(void 0===a?this:a)}),s}return this.each(function(){var n=t(this),o=n.data("fa.editable");o||n.data("fa.editable",o=new e(this,i))})},t.fn.editable.Constructor=e,t.Editable=e,t.fn.editable.noConflict=function(){return t.fn.editable=i,this}}(window.jQuery),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t,e){function i(t){function e(){n?(i(),U(e),o=!0,n=!1):o=!1}var i=t,n=!1,o=!1;this.kick=function(){n=!0,o||e()},this.end=function(t){var e=i;t&&(o?(i=n?function(){e(),t()}:t,n=!0):t())}}function n(){return!0}function o(){return!1}function s(t){t.preventDefault()}function a(t){O[t.target.tagName.toLowerCase()]||t.preventDefault()}function r(t){return 1===t.which&&!t.ctrlKey&&!t.altKey}function h(t,e){var i,n;if(t.identifiedTouch)return t.identifiedTouch(e);for(i=-1,n=t.length;++i<n;)if(t[i].identifier===e)return t[i]}function l(t,e){var i=h(t.changedTouches,e.identifier);if(i&&(i.pageX!==e.pageX||i.pageY!==e.pageY))return i}function p(t){var e;r(t)&&(e={target:t.target,startX:t.pageX,startY:t.pageY,timeStamp:t.timeStamp},D(document,H.move,d,e),D(document,H.cancel,c,e))}function d(t){var e=t.data;y(t,e,t,u)}function c(){u()}function u(){F(document,H.move,d),F(document,H.cancel,c)}function f(t){var e,i;O[t.target.tagName.toLowerCase()]||(e=t.changedTouches[0],i={target:e.target,startX:e.pageX,startY:e.pageY,timeStamp:t.timeStamp,identifier:e.identifier},D(document,P.move+"."+e.identifier,m,i),D(document,P.cancel+"."+e.identifier,g,i))}function m(t){var e=t.data,i=l(t,e);i&&y(t,e,i,v)}function g(t){var e=t.data,i=h(t.changedTouches,e.identifier);i&&v(e.identifier)}function v(t){F(document,"."+t,m),F(document,"."+t,g)}function y(t,e,i,n){var o=i.pageX-e.startX,s=i.pageY-e.startY;B*B>o*o+s*s||k(t,e,i,o,s,n)}function b(){return this._handled=n,!1}function w(t){try{t._handled()}catch(e){return!1}}function k(t,e,i,n,o,s){{var a,r;e.target}a=t.targetTouches,r=t.timeStamp-e.timeStamp,e.type="movestart",e.distX=n,e.distY=o,e.deltaX=n,e.deltaY=o,e.pageX=i.pageX,e.pageY=i.pageY,e.velocityX=n/r,e.velocityY=o/r,e.targetTouches=a,e.finger=a?a.length:1,e._handled=b,e._preventTouchmoveDefault=function(){t.preventDefault()},N(e.target,e),s(e.identifier)}function _(t){var e=t.data.timer;t.data.touch=t,t.data.timeStamp=t.timeStamp,e.kick()}function $(t){var e=t.data.event,i=t.data.timer;x(),L(e,i,function(){setTimeout(function(){F(e.target,"click",o)},0)})}function x(){F(document,H.move,_),F(document,H.end,$)
}function C(t){var e=t.data.event,i=t.data.timer,n=l(t,e);n&&(t.preventDefault(),e.targetTouches=t.targetTouches,t.data.touch=n,t.data.timeStamp=t.timeStamp,i.kick())}function S(t){var e=t.data.event,i=t.data.timer,n=h(t.changedTouches,e.identifier);n&&(T(e),L(e,i))}function T(t){F(document,"."+t.identifier,C),F(document,"."+t.identifier,S)}function I(t,e,i){var n=i-t.timeStamp;t.type="move",t.distX=e.pageX-t.startX,t.distY=e.pageY-t.startY,t.deltaX=e.pageX-t.pageX,t.deltaY=e.pageY-t.pageY,t.velocityX=.3*t.velocityX+.7*t.deltaX/n,t.velocityY=.3*t.velocityY+.7*t.deltaY/n,t.pageX=e.pageX,t.pageY=e.pageY}function L(t,e,i){e.end(function(){return t.type="moveend",N(t.target,t),i&&i()})}function E(){return D(this,"movestart.move",w),!0}function M(){return F(this,"dragstart drag",s),F(this,"mousedown touchstart",a),F(this,"movestart",w),!0}function A(t){"move"!==t.namespace&&"moveend"!==t.namespace&&(D(this,"dragstart."+t.guid+" drag."+t.guid,s,e,t.selector),D(this,"mousedown."+t.guid,a,e,t.selector))}function R(t){"move"!==t.namespace&&"moveend"!==t.namespace&&(F(this,"dragstart."+t.guid+" drag."+t.guid),F(this,"mousedown."+t.guid))}var B=6,D=t.event.add,F=t.event.remove,N=function(e,i,n){t.event.trigger(i,n,e)},U=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(function(){t()},25)}}(),O={textarea:!0,input:!0,select:!0,button:!0},H={move:"mousemove",cancel:"mouseup dragstart",end:"mouseup"},P={move:"touchmove",cancel:"touchend",end:"touchend"};t.event.special.movestart={setup:E,teardown:M,add:A,remove:R,_default:function(t){function n(){I(s,a.touch,a.timeStamp),N(t.target,s)}var s,a;t._handled()&&(s={target:t.target,startX:t.startX,startY:t.startY,pageX:t.pageX,pageY:t.pageY,distX:t.distX,distY:t.distY,deltaX:t.deltaX,deltaY:t.deltaY,velocityX:t.velocityX,velocityY:t.velocityY,timeStamp:t.timeStamp,identifier:t.identifier,targetTouches:t.targetTouches,finger:t.finger},a={event:s,timer:new i(n),touch:e,timeStamp:e},t.identifier===e?(D(t.target,"click",o),D(document,H.move,_,a),D(document,H.end,$,a)):(t._preventTouchmoveDefault(),D(document,P.move+"."+t.identifier,C,a),D(document,P.end+"."+t.identifier,S,a)))}},t.event.special.move={setup:function(){D(this,"movestart.move",t.noop)},teardown:function(){F(this,"movestart.move",t.noop)}},t.event.special.moveend={setup:function(){D(this,"movestart.moveend",t.noop)},teardown:function(){F(this,"movestart.moveend",t.noop)}},D(document,"mousedown.move",p),D(document,"touchstart.move",f),"function"==typeof Array.prototype.indexOf&&!function(t){for(var e=["changedTouches","targetTouches"],i=e.length;i--;)-1===t.event.props.indexOf(e[i])&&t.event.props.push(e[i])}(t)}),window.WYSIWYGModernizr=function(t,e,i){function n(t){u.cssText=t}function o(t,e){return typeof t===e}var s,a,r,h="2.7.1",l={},p=e.documentElement,d="modernizr",c=e.createElement(d),u=c.style,f=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),m={},g=[],v=g.slice,y=function(t,i,n,o){var s,a,r,h,l=e.createElement("div"),c=e.body,u=c||e.createElement("body");if(parseInt(n,10))for(;n--;)r=e.createElement("div"),r.id=o?o[n]:d+(n+1),l.appendChild(r);return s=["&#173;",'<style id="s',d,'">',t,"</style>"].join(""),l.id=d,(c?l:u).innerHTML+=s,u.appendChild(l),c||(u.style.background="",u.style.overflow="hidden",h=p.style.overflow,p.style.overflow="hidden",p.appendChild(u)),a=i(l,t),c?l.parentNode.removeChild(l):(u.parentNode.removeChild(u),p.style.overflow=h),!!a},b=function(e){var i=t.matchMedia||t.msMatchMedia;if(i)return i(e).matches;var n;return y("@media "+e+" { #"+d+" { position: absolute; } }",function(e){n="absolute"==(t.getComputedStyle?getComputedStyle(e,null):e.currentStyle).position}),n},w={}.hasOwnProperty;r=o(w,"undefined")||o(w.call,"undefined")?function(t,e){return e in t&&o(t.constructor.prototype[e],"undefined")}:function(t,e){return w.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var i=v.call(arguments,1),n=function(){if(this instanceof n){var o=function(){};o.prototype=e.prototype;var s=new o,a=e.apply(s,i.concat(v.call(arguments)));return Object(a)===a?a:s}return e.apply(t,i.concat(v.call(arguments)))};return n}),m.touch=function(){var i;return"ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch?i=!0:y(["@media (",f.join("touch-enabled),("),d,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(t){i=9===t.offsetTop}),i};for(var k in m)r(m,k)&&(a=k.toLowerCase(),l[a]=m[k](),g.push((l[a]?"":"no-")+a));return l.addTest=function(t,e){if("object"==typeof t)for(var n in t)r(t,n)&&l.addTest(n,t[n]);else{if(t=t.toLowerCase(),l[t]!==i)return l;e="function"==typeof e?e():e,"undefined"!=typeof enableClasses&&enableClasses&&(p.className+=" "+(e?"":"no-")+t),l[t]=e}return l},n(""),c=s=null,l._version=h,l._prefixes=f,l.mq=b,l.testStyles=y,l}(this,this.document),function(){function t(t){return t.replace(/^\s+|\s+$/g,"")}function e(t){return t.replace(/^\s+/g,"")}function i(i,n,o,s){function a(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.newlines=0,this.indent_content=h,this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(t,e){for(var i=0;i<e.length;i++)if(t===e[i])return!0;return!1}},this.traverse_whitespace=function(){var t="";if(t=this.input.charAt(this.pos),this.Utils.in_array(t,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(t,this.Utils.whitespace);)f&&"\n"===t&&this.newlines<=m&&(this.newlines+=1),this.pos++,t=this.input.charAt(this.pos);return!0}return!1},this.get_content=function(){for(var t="",e=[],i=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return e.length?e.join(""):["","TK_EOF"];if(this.traverse_whitespace())e.length&&(i=!0);else{if(g){var n=this.input.substr(this.pos,3);if("{{#"===n||"{{/"===n)break;if("{{"===this.input.substr(this.pos,2)&&"{{else}}"===this.get_tag(!0))break}t=this.input.charAt(this.pos),this.pos++,i&&(this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,e),this.print_indentation(e)):(this.line_char_count++,e.push(" ")),i=!1),this.line_char_count++,e.push(t)}}return e.length?e.join(""):""},this.get_contents_to=function(t){if(this.pos===this.input.length)return["","TK_EOF"];var e="",i=new RegExp("</"+t+"\\s*>","igm");i.lastIndex=this.pos;var n=i.exec(this.input),o=n?n.index:this.input.length;return this.pos<o&&(e=this.input.substring(this.pos,o),this.pos=o),e},this.record_tag=function(t){this.tags[t+"count"]?(this.tags[t+"count"]++,this.tags[t+this.tags[t+"count"]]=this.indent_level):(this.tags[t+"count"]=1,this.tags[t+this.tags[t+"count"]]=this.indent_level),this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent,this.tags.parent=t+this.tags[t+"count"]},this.retrieve_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]],this.tags.parent=this.tags[e+"parent"]),delete this.tags[t+this.tags[t+"count"]+"parent"],delete this.tags[t+this.tags[t+"count"]],1===this.tags[t+"count"]?delete this.tags[t+"count"]:this.tags[t+"count"]--}},this.indent_to_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]])}},this.get_tag=function(t){var e,i,n,o="",s=[],a="",r=!1,h=this.pos,l=this.line_char_count;t=void 0!==t?t:!1;do{if(this.pos>=this.input.length)return t&&(this.pos=h,this.line_char_count=l),s.length?s.join(""):["","TK_EOF"];if(o=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(o,this.Utils.whitespace))r=!0;else{if(("'"===o||'"'===o)&&(o+=this.get_unformatted(o),r=!0),"="===o&&(r=!1),s.length&&"="!==s[s.length-1]&&">"!==o&&r&&(this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,s),this.print_indentation(s)):(s.push(" "),this.line_char_count++),r=!1),g&&"<"===n&&o+this.input.charAt(this.pos)==="{{"&&(o+=this.get_unformatted("}}"),s.length&&" "!==s[s.length-1]&&"<"!==s[s.length-1]&&(o=" "+o),r=!0),"<"!==o||n||(e=this.pos-1,n="<"),g&&!n&&s.length>=2&&"{"===s[s.length-1]&&"{"==s[s.length-2]&&(e="#"===o||"/"===o?this.pos-3:this.pos-2,n="{"),this.line_char_count++,s.push(o),s[1]&&"!"===s[1]){s=[this.get_comment(e)];break}if(g&&"{"===n&&s.length>2&&"}"===s[s.length-2]&&"}"===s[s.length-1])break}}while(">"!==o);var p,d,c=s.join("");p=c.indexOf(-1!==c.indexOf(" ")?" ":"{"===c[0]?"}":">"),d="<"!==c[0]&&g?"#"===c[2]?3:2:1;var f=c.substring(d,p).toLowerCase();return"/"===c.charAt(c.length-2)||this.Utils.in_array(f,this.Utils.single_token)?t||(this.tag_type="SINGLE"):g&&"{"===c[0]&&"else"===f?t||(this.indent_to_tag("if"),this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace()):"script"===f?t||(this.record_tag(f),this.tag_type="SCRIPT"):"style"===f?t||(this.record_tag(f),this.tag_type="STYLE"):this.is_unformatted(f,u)?(a=this.get_unformatted("</"+f+">",c),s.push(a),e>0&&this.Utils.in_array(this.input.charAt(e-1),this.Utils.whitespace)&&s.splice(0,0,this.input.charAt(e-1)),i=this.pos-1,this.Utils.in_array(this.input.charAt(i+1),this.Utils.whitespace)&&s.push(this.input.charAt(i+1)),this.tag_type="SINGLE"):"!"===f.charAt(0)?t||(this.tag_type="SINGLE",this.traverse_whitespace()):t||("/"===f.charAt(0)?(this.retrieve_tag(f.substring(1)),this.tag_type="END",this.traverse_whitespace()):(this.record_tag(f),"html"!==f.toLowerCase()&&(this.indent_content=!0),this.tag_type="START",this.traverse_whitespace()),this.Utils.in_array(f,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output))),t&&(this.pos=h,this.line_char_count=l),s.join("")},this.get_comment=function(t){var e="",i=">",n=!1;for(this.pos=t,input_char=this.input.charAt(this.pos),this.pos++;this.pos<=this.input.length&&(e+=input_char,e[e.length-1]!==i[i.length-1]||-1===e.indexOf(i));)!n&&e.length<10&&(0===e.indexOf("<![if")?(i="<![endif]>",n=!0):0===e.indexOf("<![cdata[")?(i="]]>",n=!0):0===e.indexOf("<![")?(i="]>",n=!0):0===e.indexOf("<!--")&&(i="-->",n=!0)),input_char=this.input.charAt(this.pos),this.pos++;return e},this.get_unformatted=function(t,e){if(e&&-1!==e.toLowerCase().indexOf(t))return"";var i="",n="",o=0,s=!0;do{if(this.pos>=this.input.length)return n;if(i=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(i,this.Utils.whitespace)){if(!s){this.line_char_count--;continue}if("\n"===i||"\r"===i){n+="\n",this.line_char_count=0;continue}}n+=i,this.line_char_count++,s=!0,g&&"{"===i&&n.length&&"{"===n[n.length-2]&&(n+=this.get_unformatted("}}"),o=n.length)}while(-1===n.toLowerCase().indexOf(t,o));return n},this.get_token=function(){var t;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var e=this.last_token.substr(7);return t=this.get_contents_to(e),"string"!=typeof t?t:[t,"TK_"+e]}if("CONTENT"===this.current_mode)return t=this.get_content(),"string"!=typeof t?t:[t,"TK_CONTENT"];if("TAG"===this.current_mode){if(t=this.get_tag(),"string"!=typeof t)return t;var i="TK_TAG_"+this.tag_type;return[t,i]}},this.get_full_indent=function(t){return t=this.indent_level+t||0,1>t?"":Array(t+1).join(this.indent_string)},this.is_unformatted=function(t,e){if(!this.Utils.in_array(t,e))return!1;if("a"!==t.toLowerCase()||!this.Utils.in_array("a",e))return!0;var i=this.get_tag(!0),n=(i||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!n||this.Utils.in_array(n,e)?!0:!1},this.printer=function(t,i,n,o,s){this.input=t||"",this.output=[],this.indent_character=i,this.indent_string="",this.indent_size=n,this.brace_style=s,this.indent_level=0,this.wrap_line_length=o,this.line_char_count=0;for(var a=0;a<this.indent_size;a++)this.indent_string+=this.indent_character;this.print_newline=function(t,e){this.line_char_count=0,e&&e.length&&(t||"\n"!==e[e.length-1])&&e.push("\n")},this.print_indentation=function(t){for(var e=0;e<this.indent_level;e++)t.push(this.indent_string),this.line_char_count+=this.indent_string.length},this.print_token=function(t){(t||""!==t)&&this.output.length&&"\n"===this.output[this.output.length-1]&&(this.print_indentation(this.output),t=e(t)),this.print_token_raw(t)},this.print_token_raw=function(t){t&&""!==t&&(t.length>1&&"\n"===t[t.length-1]?(this.output.push(t.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(t));for(var e=0;e<this.newlines;e++)this.print_newline(e>0,this.output);this.newlines=0},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var r,h,l,p,d,c,u,f,m,g;for(n=n||{},void 0!==n.wrap_line_length&&0!==parseInt(n.wrap_line_length,10)||void 0===n.max_char||0===parseInt(n.max_char,10)||(n.wrap_line_length=n.max_char),h=n.indent_inner_html||!0,l=parseInt(n.indent_size||1,10),p=n.indent_char||"	",c=n.brace_style||"collapse",d=0===parseInt(n.wrap_line_length,10)?32786:parseInt(n.wrap_line_length||1e5,10),u=n.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],f=n.preserve_newlines||!0,m=f?parseInt(n.max_preserve_newlines||32786,10):0,g=n.indent_handlebars||!0,r=new a,r.printer(i,p,l,d,c);;){var v=r.get_token();if(r.token_text=v[0],r.token_type=v[1],"TK_EOF"===r.token_type)break;switch(r.token_type){case"TK_TAG_START":r.print_newline(!1,r.output),r.print_token(r.token_text),r.indent_content&&(r.indent(),r.indent_content=!1),r.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":r.print_newline(!1,r.output),r.print_token(r.token_text),r.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===r.last_token&&""===r.last_text){var y=r.token_text.match(/\w+/)[0],b=null;r.output.length&&(b=r.output[r.output.length-1].match(/(?:<|{{#)\s*(\w+)/)),(null===b||b[1]!==y)&&r.print_newline(!1,r.output)}r.print_token(r.token_text),r.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var w=r.token_text.match(/^\s*<([a-z]+)/i);w&&r.Utils.in_array(w[1],u)||r.print_newline(!1,r.output),r.print_token(r.token_text),r.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":r.print_token(r.token_text),r.indent_content&&(r.indent(),r.indent_content=!1),r.current_mode="CONTENT";break;case"TK_CONTENT":r.print_token(r.token_text),r.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==r.token_text){r.print_newline(!1,r.output);var k,_=r.token_text,$=1;"TK_SCRIPT"===r.token_type?k="function"==typeof o&&o:"TK_STYLE"===r.token_type&&(k="function"==typeof s&&s),"keep"===n.indent_scripts?$=0:"separate"===n.indent_scripts&&($=-r.indent_level);var x=r.get_full_indent($);if(k)_=k(_.replace(/^\s*/,x),n);else{var C=_.match(/^\s*/)[0],S=C.match(/[^\n\r]*$/)[0].split(r.indent_string).length-1,T=r.get_full_indent($-S);_=_.replace(/^\s*/,x).replace(/\r\n|\r|\n/g,"\n"+T).replace(/\s+$/,"")}_&&(r.print_token_raw(x+t(_)),r.print_newline(!1,r.output))}r.current_mode="TAG"}r.last_token=r.token_type,r.last_text=r.token_text}return r.output.join("")}if("function"==typeof define&&define.amd)define(["./beautify","./beautify-css"],function(t,e){return{html_beautify:function(n,o){return i(n,o,t,e)}}});else if("undefined"!=typeof exports){var n=require("./beautify.js").js_beautify,o=require("./beautify-css.js").css_beautify;exports.html_beautify=function(t,e){return i(t,e,n,o)}}else"undefined"!=typeof window?window.html_beautify=function(t,e){return i(t,e,window.js_beautify,window.css_beautify)}:"undefined"!=typeof global&&(global.html_beautify=function(t,e){return i(t,e,global.js_beautify,global.css_beautify)})}();