Pongo.UI={$body:$(document.body),$win:$(window),$wrapper:$(".wrapper"),$navbar:$(".navbar"),$overlay:$(".overlay"),$container:$(".container"),$alert_box:$(".alert-msg"),$breadcrumb:$(".breadcrumb-wrapper"),$btn_clicked:null,$box_checked:null,$box_status:null,$layout_radio:null,$modal:null,btn_text:null,lang:null,timeout:1e3,init:function(){this.loadingSpinner(),this.loadingCheckbox(),this.onCloseModal(),this.windowResize(this.adjustModal())},addSpin:function(){this.btn_text=this.$btn_clicked.html(),this.checkSpin()||(-1==this.btn_text.indexOf("<i")?this.$btn_clicked.prepend(Pongo.Templates.loading_tpl):this.$btn_clicked.find("i").removeClass().addClass("fa fa-refresh fa-spin"))},addShake:function(){Pongo.Form.$form.addClass("shake")},hideModal:function(){this.$modal&&this.$modal.modal("hide")},onCloseModal:function(){$(".modal").on("hidden.bs.modal",function(){Pongo.UI.resetBtn()})},createAlertMessage:function(e){this.$alert_box.remove();var t=$("<div/>").attr("class","alert-msg").addClass(e.status).html(e.msg);"expired"==e.type?Pongo.Form.redirectTo("login"):(this.$alert_box=t,Modernizr.touch?(this.$alert_box.addClass("fixfixed"),this.$body.animate({scrollTop:0},0).prepend(t)):this.$body.prepend(t))},checkAllCopy:function(){$("#copy_all").change(function(){$(".copy_block").prop("checked",this.checked)})},checkSpin:function(){return this.$btn_clicked.find("i").hasClass("fa-spin")},checkBoxSpin:function(){return this.$box_checked?this.$box_checked.next("strong").find("i").hasClass("fa-spin"):!1},checkEmptyList:function(){return Pongo.Nestable.$item_list.children().html()},activePageList:function(){return Pongo.Nestable.$page_list.filter("[rel="+this.lang+"]")},loadingSpinner:function(){var e=this;$(".pongo-loading").on("click",function(t){t.preventDefault();var o=$(this);e.resetBtn(),e.$btn_clicked=o,e.addSpin()})},loadingCheckbox:function(){var e=this;$(".pongo-checking").on("click",":checkbox",function(t){if(e.$box_checked=$(this),e.checkBoxSpin())t.preventDefault();else{e.$box_status=this.checked?!0:!1,e.$box_status&&t.preventDefault();var o=e.$box_checked.next("strong");o.append(Pongo.Templates.loading_tpl)}})},magnificPopup:function(){$(".pongo-lightbox").magnificPopup({delegate:"[data-toggle=lightbox]",type:"image"})},paginateList:function(e){$.LoadNext({container:".pongo-paginating",next_link:"li:last-child a",item:e,label:Pongo.load,btn_class:"load-more",onClickNext:this.paginateSpinner,onLoadComplete:this.paginateSpinnerReset})},paginateSpinner:function(){var e=$(this);Pongo.UI.$btn_clicked=e,Pongo.UI.addSpin()},paginateSpinnerReset:function(){Pongo.UI.resetBtn()},resetCheckbox:function(){this.$box_checked&&(this.$box_checked.next("strong").empty(),this.$box_checked.prop("checked",this.$box_status))},resetOtherCheckboxes:function(){this.$box_checked.parents(".pongo-select").find("input[type=checkbox]").prop("checked",!1)},resetBtn:function(){var e=this;this.btn_text&&this.$btn_clicked&&(e.$btn_clicked.html(e.btn_text),e.$btn_clicked=null)},resetShake:function(){Pongo.Form.$form.removeClass("shake")},resetFieldErrors:function(){var e=Pongo.Form.$form;e.find(".form-group").removeClass("has-error"),e.find(".err").remove()},resetModalShake:function(){this.$modal&&this.$modal.on("hidden.bs.modal",function(){Pongo.Form.$form&&Pongo.Form.$form.removeClass("shake")})},showLogo:function(){var e=$(".login-wrapper");e.on("focus","input",function(){e.addClass("animate")}).on("blur","input",function(){e.removeClass("animate")})},tagSelectize:function(){$(".pongo-selectize").selectize({delimiter:",",valueField:"id",labelField:"name",searchField:["name"],maxOptions:10,create:function(e){return{id:e,name:e}},render:{item:function(e){return'<div data-value="'+e.id+'">'+e.name+"</div>"},option:function(e,t){return'<div data-value="'+e.id+'">'+t(e.name)+"</div>"}},load:function(e,t){if(!e.length)return t();var o=Pongo.Utils.url("api/tags");$.post(o,{q:e},function(e){t(e)})}})},adjustModal:function(){$(".modal").each(function(){0==$(this).hasClass("in")&&$(this).show();var e=$(window).height()-60,t=$(this).find(".modal-header").outerHeight()||2,o=$(this).find(".modal-footer").outerHeight()||2;$(this).find(".modal-content").css({"max-height":function(){return e}}),$(this).find(".modal-body").css({"max-height":function(){return e-(t+o)}}),$(this).find(".modal-dialog").css({"margin-top":function(){return(e-$(this).outerHeight())/2}}),0==$(this).hasClass("in")&&$(this).hide()})},windowResize:function(e){$(window).resize(e).trigger("resize")}},Pongo.Block={$editor:$("#edit"),$livenav:$(".pongo-live"),$inline:null,attrib:null,init:function(){this.initFroala(this.$editor,this.editorSettings),this.insertItem(),this.saveFroala(),this.liveOn(),this.liveOff(),this.saveLive()},editorSettings:{autosave:!0,autosaveInterval:12e4,buttons:["formatBlock","color","sep","bold","italic","underline","strikeThrough","sep","insertHorizontalRule","insertUnorderedList","insertOrderedList","align","sep","outdent","indent","sep","createLink","insertImage","sep","undo","redo","sep","selectAll","html"],crossDomain:!1,editorClass:"pongo-editor",imageUploadParam:"files[]",inlineMode:!1,mediaManager:!1,plainPaste:!0,afterSaveCallback:function(e){Pongo.UI.createAlertMessage(e),Pongo.UI.resetBtn()},imageLoadedCallback:function(e){var t=e.split("/"),o=t.pop(),a=o.replace(".","_cms."),n=e.replace(o,a),i=_.template(Pongo.Templates.file_tool_tpl),l=i({url:e,cms_url:n,name:o});$("#files").find(".tool-list").append(l)},imageErrorCallback:function(e){if(8==e.errorCode){var t={status:"error",msg:e.errorStatus};Pongo.UI.createAlertMessage(t)}}},initFroala:function(e,t){e.editable(t),e.editable("option","saveParams",{id:Pongo.Utils.blockId(),lang:Pongo.UI.lang,section:"content"}),e.editable("option","saveURL",Pongo.Utils.url("api/block/save/content")),e.editable("option","imageUploadParams",{page_id:Pongo.Utils.pageId(),type:"editor"}),e.editable("option","imageUploadURL",Pongo.Utils.url("api/file/upload")),e.editable("option","allowedImageTypes",Pongo.mimes.split(",")),e.editable("option","maxImageSize",Pongo.max_upload_size),e.editable("option","language",Pongo.locale)},inlineSettings:{autosave:!0,autosaveInterval:12e4,buttons:["formatBlock","color","bold","italic","underline","strikeThrough","insertHorizontalRule","insertUnorderedList","insertOrderedList","sep","align","outdent","indent","createLink","insertImage","undo","redo","selectAll","html"],crossDomain:!1,editorClass:"pongo-editor",imageUploadParam:"files[]",inlineMode:!0,mediaManager:!1,plainPaste:!0,afterSaveCallback:function(e){Pongo.UI.createAlertMessage(e),Pongo.UI.resetBtn()},imageErrorCallback:function(e){if(8==e.errorCode){var t={status:"error",msg:e.errorStatus};Pongo.UI.createAlertMessage(t)}}},insertItem:function(){var e=this;$(".tool-list").on("click",".pongo-insert",function(t){t.preventDefault();var o=$(this),a=null,n=null,i=o.attr("href"),l=o.data("default");o.is("[data-tag]")&&(a=o.data("tag"),n=o.prev("div").find(".pongo-"+a).attr("href"));var s=a?e.formatTag(a,n,i):l;s&&e.insertFroala(s)})},formatTag:function(e,t,o){switch(e){case"img":return'<img src="'+t+'" />';case"file":return'<a href="'+t+'" >'+o+"</a>";default:return t}},insertFroala:function(e){this.$editor.editable("insertHTML",e,!0)},saveFroala:function(){var e=this;$(".froala-ajax-submit").on("click",function(t){t.preventDefault(),e.$editor.editable("save")})},saveLive:function(){var e=this;$(".froala-live-submit").on("click",function(t){t.preventDefault(),e.$inline.editable("save")})},liveOn:function(){var e=this;$(".pongo-live-on").on("click",function(t){t.preventDefault();var o=$(".pongo-slug").data("slug"),a=_.template(Pongo.Templates.live_wrapper),n="",i=$("#attrib").val();$.ajax({type:"GET",url:Pongo.Utils.site(o),success:function(e){n=a({html:e})},context:e,dataType:"html"}).done(function(){Pongo.UI.$container.before(n),e.$livenav.show(),Pongo.UI.resetBtn(),e.$inline=$("#"+i),e.initFroala(e.$inline,e.inlineSettings)})})},liveOff:function(){var e=this;this.$livenav.on("click",".pongo-live-off",function(){$(".froala-live-submit").trigger("click"),e.refreshHTML(),e.$inline.editable("destroy"),$(".pongo-live").hide(),$(".live").remove()})},refreshHTML:function(){var e=this.$inline.find(".pongo-editor").html();this.$editor.editable("setHTML",e)}},Pongo.Factory={url:null,tpl:null,createBlock:function(e){var t=this;$("#create-block").on("click",function(o){o.preventDefault();var a=($(this),Pongo.Utils.pageId()),n="radio"==e?$("input[name=zone]:checked").val():$("#change-zone").val();t.tpl=Pongo.Templates.new_block_tpl,t.url=Pongo.Utils.url("api/block/create"),t.sendRequest({lang:Pongo.UI.lang,page_id:a,zone:n})})},createPage:function(){var e=this;$("#create-page").on("click",function(t){t.preventDefault(),e.tpl=Pongo.Templates.new_page_tpl,e.url=Pongo.Utils.url("api/page/create"),e.sendRequest({lang:Pongo.UI.lang})})},createRole:function(){var e=this;$("#create-role").on("click",function(t){t.preventDefault(),e.tpl=Pongo.Templates.new_role_tpl,e.url=Pongo.Utils.url("api/role/create"),e.sendRequest(null)})},createUser:function(){var e=this;$("#create-user").on("click",function(t){t.preventDefault(),e.tpl=Pongo.Templates.new_user_tpl,e.url=Pongo.Utils.url("api/user/create"),e.sendRequest(null)})},processResponse:function(e){if("success"==e.status){var t=(Pongo.UI.activePageList(),_.template(this.tpl)),o=t(e);"block"==e.render&&this.renderNewBlock(o,e),"page"==e.render&&this.renderNewPage(o),"role"==e.render&&this.renderNewRole(o),"user"==e.render&&this.renderNewUser(o),Pongo.UI.createAlertMessage(e,null,null)}},renderNewBlock:function(e,t){var o=Pongo.Nestable.$block_list;if(o.find("a.new").removeClass("new"),o.find(".list-empty").remove(),o.children().prepend(e),o.nestable("serialize"),t){var a=_.template(Pongo.Templates.copy_block_tpl),n=a(t);$(".copy").find(".list-wrapper").append(n)}},renderNewPage:function(e){var t=Pongo.UI.activePageList();t.find("a.new").removeClass("new"),t.find(".list-empty").remove(),t.children().prepend(e),t.nestable("serialize")},renderNewRole:function(e){var t=Pongo.Nestable.$item_list;t.find(".list-empty").remove(),t.children().append(e),t.nestable("serialize")},renderNewUser:function(e){var t=Pongo.Nestable.$item_list;t.find(".list-empty").remove(),t.children().first().prepend(e),t.nestable("serialize")},sendRequest:function(e){this.url?$.ajax({type:"POST",url:this.url,data:e,success:this.processResponse,context:this,dataType:"json"}).done(function(){Pongo.UI.resetBtn()}):console.log("No this.url")}},Pongo.File={addFileItem:function(e){var t=_.template(Pongo.Templates.file_item_tpl),o=t(e),a=$(".pongo-update");a.find(".list-empty").remove(),a.prepend(o)},showUploadPath:function(e,t){this.addFileItem(t),$("li.print").html(e),$("[name=file_name]").val(""),$("[name=file_size]").val("")},uploadFile:function(){var e=this;$("#fileuploader").uploadFile({url:Pongo.Utils.url("api/file/upload"),fileName:"files",formData:{page_id:Pongo.Utils.pageId()},allowedTypes:Pongo.mimes,maxUploads:Pongo.max_upload_items,uploadButtonClass:"btn btn-primary btn-block button",uploadCancelClass:"btn btn-danger abort",uploadStartClass:"btn btn-success start",progressDivClass:"progress progress-striped active",returnType:"json",onSubmit:function(){},onSuccess:function(t,o){$(".progress").remove(),$.each(o,function(t,o){var a=$(".status-bar ul > li[rel="+t+"]");if(a.find("i").removeClass().addClass(o.icon),o.errors){var n=_.template(Pongo.Templates.file_error_tpl);$.each(o.errors,function(e,t){a.after(n({error:t}))})}o.item&&e.addFileItem(o.item)}),Pongo.UI.createAlertMessage(o)}})}},Pongo.Form={url:null,redirect_uri:null,to:0,$form:null,$item:null,init:function(){this.confirmDialog(),this.copyDialog(),this.submitForm(),this.submitAjax(),console.log("init Form")},confirmDialog:function(){var e=this;$(".pongo-confirming").on("click",".pongo-confirm",function(t){t.preventDefault();var o=$(this),a=o.data("id");e.$item=o.parents("li").filter("[data-id="+a+"]"),Pongo.UI.$modal=$(o.data("target")),Pongo.UI.$modal.find("input[name=item_id]").val(a),Pongo.UI.resetModalShake()})},copyDialog:function(){$(".pongo-copy").on("click",function(e){e.preventDefault();var t=$(this);Pongo.UI.$modal=$(t.data("target"))})},submitForm:function(){$(".pongo-form-submit").on("click",function(e){e.preventDefault(),$(this).parents("form").submit()})},submitAjax:function(){var e=this;$(".pongo-ajax-submit").on("click",function(t){t.preventDefault();var o=$(this);o.is("[data-to]")&&(e.to=o.data("to")),e.$form=o.parents("form"),Pongo.UI.resetShake(),e.url=e.$form.attr("action"),e.sendRequest()})},sendRequest:function(){if(this.url){var e=this,t=1e3*e.to;setTimeout(function(){$.ajax({type:"POST",url:e.url,data:e.$form.serialize(),success:e.validateForm,context:e,dataType:"json"}).done(function(){Pongo.UI.resetBtn()})},t)}else console.log("No this.url")},fieldErrors:function(e){Pongo.UI.addShake(),$.each(e,function(e,t){$item=$(".form-group[rel="+e+"]"),$item.find(".help-block").remove(),$item.addClass("has-error"),$item.children("label[for="+e+"]").append('<span class="err"> - '+t+"</span>")})},redirectTo:function(e){window.location=Pongo.Utils.url(e)},redirectUrl:function(e){window.location=e},removeListItem:function(){var e=this.$item.parent();this.$item.remove(),e.html().trim()||(e.hasClass("pongo-active")?e.append(Pongo.Templates.empty_tpl):(e.siblings("[data-action]").remove(),e.remove())),Pongo.UI.hideModal()},validateForm:function(e){Pongo.UI.resetFieldErrors(),e.errors&&this.fieldErrors(e.errors),e.remove&&this.removeListItem(e.remove),"error"==e.status&&Pongo.UI.addShake(),e.msg&&Pongo.UI.createAlertMessage(e),e.page&&Pongo.Nestable.pageUpdate(e.page),e.block&&Pongo.Nestable.blockUpdate(e.block),e.print&&Pongo.File.showUploadPath(e.print.text,e.print.item),e.redirect&&this.redirectUrl(e.route),e.close&&Pongo.UI.hideModal()}},Pongo.Nestable={$page_list:$(".dd"),$item_list:$(".dl"),$block_list:$(".db"),$item_moved:null,$spinner_holder:null,dropped_id:null,dropped_class:null,init:function(){this.pageList(),this.pageExpColl()},checkSpin:function(){return this.$spinner_holder.hasClass("fa-spin")},blockList:function(){var e=this,t=e.$block_list.hasClass("pongo-moving");e.$block_list.nestable({maxDepth:0,rootClass:"db",listClass:"db-list",dragClass:"dd-dragel right",dropCallback:function(o,a){e.$item_moved=a,e.reorderItem(o,"a > i",t)}}).on("reorder",function(){e.reorderItemPost(e.$block_list,"api/page/move/blocks",t)})},blockUpdate:function(e){var t=Pongo.Nestable.$block_list,o=t.find("li[data-id="+e.id+"] > p");if(o.html(e.name),e.zone){Pongo.Toggle.$change_zone.val(e.zone).trigger("change");var a=Pongo.Toggle.$change_zone.find("option:selected").text();$(".zone-name").html(a)}},pageExpColl:function(){var e=this;$(".page-controls").on("click",function(t){var o=$(t.target),a=o.data("action");"expand-all"===a&&e.$page_list.nestable("expandAll"),"collapse-all"===a&&e.$page_list.nestable("collapseAll")})},pageList:function(){var e=this,t=e.$page_list.hasClass("pongo-moving");e.$page_list.nestable({dropCallback:function(o,a){e.$item_moved=a,e.reorderItem(o,"a > i",t)}}).on("reorder",function(){var o=e.$page_list.filter("[rel="+Pongo.UI.lang+"]");e.reorderItemPost(o,"api/page/move",t)})},pageUpdate:function(e){var t=Pongo.UI.activePageList(),o=t.find("li[data-id="+e.id+"] > p");o.find("span").html(e.name);var a=o.find(".fa-home");e.home?(t.find(".fa-home").hide(),a.show()):a.hide()},roleList:function(){var e=this,t=e.$item_list.hasClass("pongo-moving");e.$item_list.nestable({maxDepth:0,rootClass:"dl",listClass:"dl-list",notClass:"dl-not",itemClass:"dl-item",dragClass:"dl-dragel",dropCallback:function(o,a){e.$item_moved=a,e.reorderItem(o,".fa-pencil-square-o",t)}}).on("reorder",function(){var o=e.$item_list;e.reorderItemPost(o,"api/role/move",t)})},reorderItem:function(e,t,o){this.dropped_id=e,o&&this.reorderItemLoading(t)},reorderItemLoading:function(e){this.dropped_id;this.$spinner_holder=this.$item_moved.find(e);var t=this.$spinner_holder;this.dropped_class=t.attr("class"),this.checkSpin()?(this.$spinner_holder.removeClass().addClass(this.dropped_class),t.removeClass().addClass("fa fa-refresh fa-spin")):t.removeClass().addClass("fa fa-refresh fa-spin")},reorderItemReset:function(){var e=(this.dropped_id,this.$spinner_holder);e.removeClass().addClass(this.dropped_class)},reorderItemPost:function(e,t,o){var a=this,n=a.reorderStringify(e),i=Pongo.Utils.pageId();$.post(Pongo.Utils.url(t),{items:n,page_id:i},function(e){Pongo.UI.createAlertMessage(e,null,null)},"json").done(function(){o&&a.reorderItemReset()})},reorderStringify:function(e){if(JSON&&e){var t=e.nestable("serialize");return JSON.stringify(t)}var o={status:"error",msg:"Unsupported browser!"};Pongo.UI.createAlertMessage(o,null,null)}},Pongo.Templates={active_zone:'<i class="fa fa-check"></i>',empty_tpl:'<li class="list-empty"><p>'+Pongo.noresult+'</p><label class="fake"></label></li>',file_error_tpl:'<li class="error msg"><i class="fa fa-exclamation-circle"></i><%= error %></li>',file_item_tpl:'<li class="file-item" data-id="<%= id %>"><% if(is_image) { %><p><a href="<%= url_link %>" data-toggle="lightbox"><%= ico %></a><span><%= file_name %></span></p><% } else { %><p><a href="<%= url_link %>" target="_blank"><%= ico %></a><span><%= file_name %></span></p><% } %><label><input type="checkbox" value="<%= id %>" class="pongo-checkbox" checked="checked"><strong></strong></label><div class="btn-edit"><a href="<%= url_edit %>" class="btn btn-sm btn-primary"><i class="fa fa-pencil-square-o"></i></a>\n<a href="#" data-toggle="modal" data-target=".file-delete" data-id="<%= id %>" class="btn btn-sm btn-danger pongo-confirm"><i class="fa fa-trash-o"></i></a></div></li>',file_tool_tpl:'<li class="file-item"><div><a href="<%= url %>" data-toggle="lightbox" class="pongo-img"><img src="<%= cms_url %>" class="cms-thumb" alt=""></a><p><%= name %></p></div><a href="<%= name %>" class="pongo-insert" data-tag="img"><i class="fa fa-chevron-right"></i></a></li>',live_wrapper:'<div class="live"><%= html %></div>',loading_tpl:'<i class="fa fa-refresh fa-spin"></i> ',new_role_tpl:'<li class="dl-item move" data-id="<%= id %>"><p class="dd-handle"><%= name %></p><label><input type="checkbox" value="<%= id %>" class="pongo-checkbox"><strong></strong></label><div class="btn-edit"><a href="<%= url_edit %>" class="btn btn-sm btn-primary"><i class="fa fa-pencil-square-o"></i></a>\n<a href="#" data-toggle="modal" data-target=".pongo-delete" data-id="<%= id %>" class="btn btn-sm btn-danger pongo-confirm"><i class="fa fa-trash-o"></i></a></div></li>',new_page_tpl:'<li class="dd-item move" data-id="<%= id %>"><p class="dd-handle"><%= name %></p><label><input type="checkbox" value="<%= id %>" class="pongo-checkbox"><strong></strong></label><a href="<%= url %>" data-link="page" data-arrow="right" data-toggle="modal" data-target=".page-delete" data-id="<%= id %>" class="<%= cls %>"><i class="fa fa-trash-o"></i></a></li>',new_user_tpl:'<li class="dl-item" data-id="<%= id %>"><p class="dd-handle"><%= username %></p><label><input type="checkbox" value="<%= id %>" class="pongo-checkbox"><strong></strong></label><div class="btn-edit"><a href="<%= url_edit %>" class="btn btn-sm btn-primary"><i class="fa fa-pencil-square-o"></i></a>\n<a href="#" data-toggle="modal" data-target=".pongo-delete" data-id="<%= id %>" class="btn btn-sm btn-danger pongo-confirm"><i class="fa fa-trash-o"></i></a></div></li>',new_block_tpl:'<li class="dd-item move" data-id="<%= id %>"><p class="dd-handle"><%= name %></p><% if(is_active == 0) { %><label><input type="checkbox" value="<%= id %>" data-page="<%= page_id %>" class="pongo-checkbox"><strong></strong></label><a href="#" data-link="block" data-arrow="left" data-toggle="modal" data-target=".pongo-delete" data-id="<%= id %>" class="pongo-confirm"><i class="fa fa-trash-o"></i></a><% } else { %><label><input type="checkbox" value="<%= id %>" data-page="<%= page_id %>" class="pongo-checkbox" checked="checked"><strong></strong></label><a href="<%= url %>" data-link="block" data-arrow="left" data-id="<%= id %>"><i class="fa fa-chevron-left"></i></a><% } %></li>',copy_block_tpl:'<li><p><%= name %></p><label for="block-<%= id %>" class="page"><input type="checkbox" id="block-<%= id %>" name="blocks[]" value="<%= id %>" class="copy_block"><strong></strong></label><label for="self-<%= id %>" class="self"><input type="checkbox" id="self-<%= id %>" name="self_block[<%= id %>]" value="1"><strong></strong></label><li>'},Pongo.Toggle={$change_lang:$("#change-lang"),$change_zone:$("#change-zone"),$layout_wrapper:$(".layout-wrapper"),$block_wrapper:null,$was_checked:null,must_save:!1,init:function(){this.togglePages(),this.toggleOptions(),this.toggleLang(),this.toggleSearch(),this.toggleSelect(),this.toggleValid(),this.toggleEnabling(),this.toggleSetting(),this.untoggleOverlay(),this.toggleDelete("a","pongo-confirm")},toggleApi:function(){$(".api-toggle").on("click",function(e){e.preventDefault(),$(this).closest("div").find(".api").toggle()})},toggleSelect:function(){var e=this;$(".pongo-select").on("click",".pongo-checkbox",function(t){var o=$(this);if(e.$was_checked=o.parents(".pongo-select").find("input[type=checkbox]:checked"),Pongo.UI.checkBoxSpin()&&Pongo.UI.$box_checked!=o&&Pongo.UI.resetCheckbox(),Pongo.UI.$box_checked=o,Pongo.UI.resetOtherCheckboxes(),Pongo.UI.checkBoxSpin())t.preventDefault();else{var a=o.val(),n=o.parents("form").attr("action"),i=o.parents("form").data("user");$.post(n,{item_id:a,user_id:i},function(t){"error"==t.status?e.$was_checked.prop("checked",!0):Pongo.UI.$box_status=!0,Pongo.UI.createAlertMessage(t,null,null)},"json").done(function(){Pongo.UI.resetCheckbox()})}})},toggleValid:function(){$(".pongo-active").on("click",".pongo-checkbox",function(e){var t=$(this);if(Pongo.UI.checkBoxSpin()&&Pongo.UI.$box_checked!=t&&Pongo.UI.resetCheckbox(),Pongo.UI.$box_checked=t,Pongo.UI.checkBoxSpin())e.preventDefault();else{var o=t.val(),a=Pongo.Utils.pageId(),n=this.checked?1:0,i=t.parents("form").attr("action");$.post(i,{item_id:o,page_id:a,action:n},function(){},"json").done(function(){Pongo.UI.resetCheckbox()})}})},toggleEnabling:function(){$(".pongo-enabling").on("click",".pongo-checkbox",function(e){var t=$(this);if(Pongo.UI.checkBoxSpin()&&Pongo.UI.$box_checked!=t&&Pongo.UI.resetCheckbox(),Pongo.UI.$box_checked=t,Pongo.UI.checkBoxSpin())e.preventDefault();else{var o=t.attr("name"),a=this.checked?!0:!1,n=t.parents("form").attr("action");$.post(n,{item_name:o,action:a},function(e){Pongo.UI.createAlertMessage(e,null,null)},"json").done(function(){Pongo.UI.resetCheckbox()})}})},toggleSetting:function(){$(".pongo-setting").on("change","select",function(e){e.preventDefault();var t=$(this),o=t.attr("name"),a=t.val(),n=t.parents("form").attr("action");$.post(n,{item_name:o,value:a},function(e){Pongo.UI.createAlertMessage(e,null,null)},"json").done(function(){Pongo.UI.resetCheckbox()})})},toggleDelete:function(e,t){var o=[];$(".pongo-deleting").on("click",":checkbox",function(){var a=$(this),n=this.checked?!1:!0,i=a.parent().next(e),l=i.data("id"),s=i.data("link");void 0==o[l]&&(o[l]=i.hasClass("active"));var r=a.is("[data-page]")?a.data("page")+"/":"",c=Pongo.Utils.url(s+"/edit/"+r+i.data("id")),d=(i.attr("href"),i.data("arrow")),g="fa-chevron-"+d,p="page"==i.data("link")?".page-delete":".pongo-delete";n?(i.addClass(t).attr("data-toggle","modal").attr("data-target",p).attr("href","#"),o[l]&&i.removeClass("active"),i.find("i").toggleClass(g+" fa-trash-o")):(i.removeClass(t).removeAttr("data-toggle").removeAttr("data-target").attr("href",c),o[l]&&i.addClass("active"),i.find("i").toggleClass("fa-trash-o "+g))})},toggleLang:function(){var e=this;Pongo.UI.lang=this.$change_lang.val(),Pongo.UI.activePageList().show(),this.$change_lang.on("change",function(){Pongo.UI.lang=e.$change_lang.val(),Pongo.Nestable.$page_list.hide(),Pongo.UI.activePageList().show(),$.post(Pongo.Utils.url("api/page/lang"),{lang:Pongo.UI.lang},function(e){$(".breadcrumb > li").first().html(e.lang),Pongo.UI.createAlertMessage(e,null,null)},"json")})},toggleLangBlockCopy:function(){var e=$("#copy-lang"),t=e.val();$(".lang-copy[rel="+t+"]").show(),e.on("change",function(){t=$(this).val(),$(".lang-copy").hide(),$(".lang-copy[rel="+t+"]").show()})},toggleZone:function(){var e=this,t=this.$change_zone.find("option:selected").text();$(".sidebar.right").find("h2 > span").html(t),this.$change_zone.on("change",function(){var o=$(this),a=o.data("page"),n=o.val();e.$block_wrapper=Pongo.Nestable.$block_list.find("ol:first-child"),t=o.find("option:selected").text(),$(".sidebar.right").find("h2 > span").html(t),e.$layout_wrapper.find("i.fa").remove(),e.$layout_wrapper.find("[data-zone="+n+"]").append(Pongo.Templates.active_zone),$.post(Pongo.Utils.url("api/page/load/blocks"),{page_id:a,zone:n},function(t){if(t){var o=_.template(Pongo.Templates.new_block_tpl);e.$block_wrapper.empty(),$.each(t,function(t,n){n.is_active=0==n.pivot.is_active?0:1,n.url=0==n.is_active?"#":Pongo.Utils.url("block/edit/"+a+"/"+n.id),e.$block_wrapper.append(o(n))})}},"json")})},toggleOverallLayout:function(){this.togglePartials("template"),this.togglePartials("header"),this.togglePartials("layout"),this.togglePartials("footer"),this.toggleLoadBlocks()},togglePartials:function(e){var t=this;$(".pongo-layout-changing").on("change","#"+e,function(o){o.preventDefault();var a=$(this);if(t.must_save=!0,"layout"!=e){var n=a.find("option:selected").text();$("[data-name="+e+"]").html(n.toUpperCase())}else{var i=Pongo.Utils.url("api/page/change/layout");$.post(i,{layout:a.val()},function(e){var t=$("div[data-zone]:first").parents(".layout-wrapper").find(".row");t.slice(1,t.length-1).remove();var o=t.eq(0);o.after(e)})}})},toggleLoadBlocks:function(){var e=this;$(".pongo-blocks-loading").on("click",":radio",function(){var t=$(this),o=t.val(),a=Pongo.Utils.pageId();Pongo.UI.$layout_radio=t,e.$block_wrapper=Pongo.Nestable.$block_list.find("ol:first-child");var n=$("[data-zone="+o+"]").find("span").html();$(".sidebar.right").find("h2 > span").html(n),e.must_save&&($(".tab-pane.active").find(".pongo-ajax-submit").trigger("click"),e.must_save=!1);var i=Pongo.Utils.url("api/page/load/blocks");$.post(i,{page_id:a,zone:o},function(t){if(t){var o=_.template(Pongo.Templates.new_block_tpl);$.each(t,function(t,n){n.is_active=0==n.pivot.is_active?0:1,n.url=0==n.is_active?"#":Pongo.Utils.url("block/edit/"+a+"/"+n.id),e.$block_wrapper.append(o(n))}),Pongo.UI.$body.toggleClass("push-left")}},"json")})},toggleOptions:function(){$(".options-toggle").on("click",function(e){e.preventDefault(),Pongo.UI.$body.toggleClass("push-left")})},toggleTools:function(){$(".tools-toggle").on("click",function(e){e.preventDefault(),Pongo.UI.$body.toggleClass("hide-tools")})},togglePages:function(){var e=this;$(".pages-toggle").on("click",function(t){t.preventDefault(),Pongo.UI.$body.hasClass("push-left")&&(Pongo.UI.$body.removeClass(),e.resetBlocksLayout()),Pongo.UI.$body.toggleClass("push-right")})},toggleSearch:function(){$(".search-toggle").on("click",function(e){e.preventDefault(),Pongo.UI.$breadcrumb.toggleClass("open-search")})},untoggleOverlay:function(){var e=this;Pongo.UI.$overlay.on("click",function(){Pongo.UI.$body.removeClass("push-left push-right"),e.resetBlocksLayout()})},resetBlocksLayout:function(){Pongo.UI.$layout_radio&&(Pongo.UI.$layout_radio.prop("checked",!1),this.$block_wrapper.empty())}},Pongo.Utils={mobileBrowser:function(){return jQuery.browser.mobile?!0:!1},blockId:function(){var e=$("input[name=current_block]");return e.length>0?e.val():0},pageId:function(){var e=$("input[name=current_page]");return e.length>0?e.val():0},site:function(e){return Pongo.site+e},url:function(e){return Pongo.base+"/"+e}},Pongo.VM={countChars:function(e,t){var o=e().length,a=e();return o>t?(e(a.substring(0,t)),0):t-o},makeSlug:function(e){return e.trim().toLowerCase().replace(/ +/g,"-").replace(/-+/g,"-")},blockEdit:function(){var e=this;e.itemName=ko.observable($("#name").val()),e.blockAttrib=ko.observable($("#attrib").val()),e.createAttrib=function(){var t=e.itemName(),o=t.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-");e.blockAttrib(o)}},pageEdit:function(){var e=this;e.itemName=ko.observable($("#name").val()),e.pageSlug=ko.observable($("#slug").val()),e.slug=ko.computed(function(){return e.pageSlug()}),e.pageTitle=ko.observable($("#title").val()),e.pageDescr=ko.observable($("#descr").val()),e.titleLen=ko.computed(function(){var t=e.pageTitle;return Pongo.VM.countChars(t,70)}),e.descrLen=ko.computed(function(){var t=e.pageDescr;return Pongo.VM.countChars(t,250)}),e.createSlugName=function(){var t=Pongo.VM.makeSlug(e.itemName());$("#slug").val(t),$("#slug-last").html(t)},e.createSlugThis=function(){var e=$("#slug"),t=e.val(),o=Pongo.VM.makeSlug(t);$("#slug").val(o),$("#slug-last").html(o)}},roleEdit:function(){var e=this;e.itemName=ko.observable($("#name").val())},userEdit:function(){var e=this;e.itemName=ko.observable($("#username").val()),e.itemPassword=ko.observable($("#password").val()),e.itemConfirmed=ko.observable($("#password_confirmation").val()),e.iconFeedbackError=ko.observable(!1),e.iconFeedback=ko.observable(!1),e.iconCheckError=ko.observable(!1),e.iconCheck=ko.observable(!1),e.fieldStatus=ko.computed(function(){var t=e.itemPassword().length,o="form-group";return t>0&&8>t&&(o+=" has-error has-feedback",e.iconFeedbackError(!0),e.iconFeedback(!1)),t>=8&&(o+=" has-success has-feedback",e.iconFeedbackError(!1),e.iconFeedback(!0)),0==t&&(e.iconFeedbackError(!1),e.iconFeedback(!1)),o},e),e.passwordCheck=ko.computed(function(){var t="form-group",o=e.itemConfirmed().length;return o>0&&e.itemConfirmed()===e.itemPassword()&&(e.iconCheckError(!1),e.iconCheck(!0),t+=" has-success has-feedback"),o>0&&e.itemConfirmed()!==e.itemPassword()&&(e.iconCheckError(!0),e.iconCheck(!1),t+=" has-error has-feedback"),0==o&&(e.iconCheckError(!1),e.iconCheck(!1)),t})}},$(function(){Pongo.UI.init(),console.log("pongo.js loaded and minified!",new Date)});